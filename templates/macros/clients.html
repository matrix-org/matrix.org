{% macro classes(client) %}
{% if client.packages.apple_app_store.app_id and client.packages.apple_app_store.org %}
platform-ios
{% endif %}
{% if client.packages.google_play_store.app_id %}
platform-android
{% endif %}
{% if client.packages.flathub.app_id %}
platform-linux
{% endif %}
{% if client.packages.other_url %}
platform-web
{% endif %}
{% if client.packages.windows_installer %}
platform-windows
{% endif %}
{% if client.packages.macos_installer %}
platform-macos
{% endif %}

maturity-{{ client.maturity | lower }}

{% if client.license == "Apache-2.0" %}
licence-apache-2
{% endif %}
{% if client.license == "AGPL-3.0-only" %}
licence-agpl-3-only
{% endif %}
{% if client.license == "GPL-3.0-only" %}
licence-gpl-3-only
{% endif %}
{% if client.license == "MIT" %}
licence-mit
{% endif %}

{% for feature_name, feature_supported in client.features %}
{% if feature_supported %}feature-{{ feature_name | replace(from="_", to="-") }}{% endif %}
{% endfor %}
{% endmacro classes %}

{% macro features(features, supported) %}
{% for feature_name, supports in features %}
{% if supports == supported %}
    {% if feature_name == "e2ee" or feature_name == "sso" %}
    <p>{{ feature_name | upper }}</p>
    {% else %}
        <p>{{ feature_name | replace(from="_", to=" ") | title }}</p>
    {% endif %}
{% endif %}
{% endfor %}
{% endmacro %}

{% macro install_links(packages) %}
{% for name, package in packages %}
    {% if name == "apple_app_store" %}
        <a href="https://apps.apple.com/app/{{ package.org }}/{{ package.app_id }}"><img src="/assets/stores/app_store.svg" alt="Download on the App Store" /></a>
    {% elif name == "google_play_store" %}
        <a href="https://play.google.com/store/apps/details?id={{ package.app_id }}"><img src="/assets/stores/play_store.svg" alt="Download on Google Play" /></a>
    {% elif name == "flathub" %}
        <a href="https://flathub.org/apps/details/{{ package.app_id }}"><img src="/assets/stores/flathub.svg" alt="Download on Flathub" /></a>
    {% elif name == "f_droid" %}
        <a href="https://f-droid.org/packages/{{ package.app_id }}"><img src="/assets/stores/f-droid.svg" alt="Download on F-Droid" /></a>
    {% elif name == "windows_installer" %}
        <a href="{{ package }}"><img src="/assets/stores/download_for_windows.svg" alt="Download for Windows" /></a>
    {% elif name == "macos_installer" %}
        <a href="{{ package }}"><img src="/assets/stores/download_for_macos.svg" alt="Download for macOS" /></a>
    {% elif name == "other_url" %}
        <a href="{{ package }}"><img src="/assets/stores/use_in_browser.svg" alt="Use in your browser" /></a>
    {% endif %}
{% endfor %}
{% endmacro %}

{% macro platforms(packages) %}
{% set_global platforms = [] %}
{% for name, package in packages %}
    {% if name == "windows_installer" %}
        {% set_global plaforms = platforms | concat(with="Windows") %}
    {% elif name == "macos_installer" %}
        {% set_global plaforms = platforms | concat(with="macOS") %}
    {% elif name == "google_play_store" %}
        {% set_global plaforms = platforms | concat(with="Android") %}
    {% elif name == "f_droid" %}
        {% set_global plaforms = platforms | concat(with="Android") %}
    {% elif name == "apple_app_store" %}
        {% set_global plaforms = platforms | concat(with="iOS") %}
    {% elif name == "flathub" %}
        {% set_global plaforms = platforms | concat(with="Linux") %}
    {% elif name == "other_url" %}
        {% set_global plaforms = platforms | concat(with="Web") %}
    {% endif %}
{% endfor %}
{% set platforms = platforms | unique %}
{% for platform in platforms %}
    <div class="platform-pill">{{ platform }}</div>
{% endfor %}
{% endmacro %}
