<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.14: http://docutils.sourceforge.net/" />
<title>Push Gateway API</title>
<style type="text/css">

/*
 * basic.css
 * ~~~~~~~~~
 *
 * Sphinx stylesheet -- basic theme.
 *
 * :copyright: Copyright 2007-2010 by the Sphinx team, see AUTHORS.
 * :license: BSD, see LICENSE for details.
 *
 */

/* -- main layout ----------------------------------------------------------- */

div.clearer {
    clear: both;
}

/* -- relbar ---------------------------------------------------------------- */

div.related {
    width: 100%;
    font-size: 90%;
}

div.related h3 {
    display: none;
}

div.related ul {
    margin: 0;
    padding: 0 0 0 10px;
    list-style: none;
}

div.related li {
    display: inline;
}

div.related li.right {
    float: right;
    margin-right: 5px;
}

/* -- sidebar --------------------------------------------------------------- */

div.sphinxsidebarwrapper {
    padding: 10px 5px 0 10px;
}

div.sphinxsidebar {
    float: left;
    width: 230px;
    margin-left: -100%;
    font-size: 90%;
}

div.sphinxsidebar ul {
    list-style: none;
}

div.sphinxsidebar ul ul,
div.sphinxsidebar ul.want-points {
    margin-left: 20px;
    list-style: square;
}

div.sphinxsidebar ul ul {
    margin-top: 0;
    margin-bottom: 0;
}

div.sphinxsidebar form {
    margin-top: 10px;
}

div.sphinxsidebar input {
    border: 1px solid #98dbcc;
    font-family: sans-serif;
    font-size: 1em;
}

img {
    border: 0;
}

/* -- search page ----------------------------------------------------------- */

ul.search {
    margin: 10px 0 0 20px;
    padding: 0;
}

ul.search li {
    padding: 5px 0 5px 20px;
    background-image: url(file.png);
    background-repeat: no-repeat;
    background-position: 0 7px;
}

ul.search li a {
    font-weight: bold;
}

ul.search li div.context {
    color: #888;
    margin: 2px 0 0 30px;
    text-align: left;
}

ul.keywordmatches li.goodmatch a {
    font-weight: bold;
}

/* -- index page ------------------------------------------------------------ */

table.contentstable {
    width: 90%;
}

table.contentstable p.biglink {
    line-height: 150%;
}

a.biglink {
    font-size: 1.3em;
}

span.linkdescr {
    font-style: italic;
    padding-top: 5px;
    font-size: 90%;
}

/* -- general index --------------------------------------------------------- */

table.indextable {
    width: 100%;
}

table.indextable td {
    text-align: left;
    vertical-align: top;
}

table.indextable dl, table.indextable dd {
    margin-top: 0;
    margin-bottom: 0;
}

table.indextable tr.pcap {
    height: 10px;
}

table.indextable tr.cap {
    margin-top: 10px;
    background-color: #f2f2f2;
}

img.toggler {
    margin-right: 3px;
    margin-top: 3px;
    cursor: pointer;
}

div.modindex-jumpbox {
    border-top: 1px solid #ddd;
    border-bottom: 1px solid #ddd;
    margin: 1em 0 1em 0;
    padding: 0.4em;
}

div.genindex-jumpbox {
    border-top: 1px solid #ddd;
    border-bottom: 1px solid #ddd;
    margin: 1em 0 1em 0;
    padding: 0.4em;
}

/* -- general body styles --------------------------------------------------- */

a.headerlink {
    visibility: hidden;
}

h1:hover > a.headerlink,
h2:hover > a.headerlink,
h3:hover > a.headerlink,
h4:hover > a.headerlink,
h5:hover > a.headerlink,
h6:hover > a.headerlink,
dt:hover > a.headerlink {
    visibility: visible;
}

div.document p.caption {
    text-align: inherit;
}

div.document td {
    text-align: left;
}

.field-list ul {
    padding-left: 1em;
}

.first {
    margin-top: 0 !important;
}

p.rubric {
    margin-top: 30px;
    font-weight: bold;
}

.align-left {
    text-align: left;
}

.align-center {
    clear: both;
    text-align: center;
}

.align-right {
    text-align: right;
}

/* -- sidebars -------------------------------------------------------------- */

div.sidebar {
    margin: 0 0 0.5em 1em;
    border: 1px solid #ddb;
    padding: 7px 7px 0 7px;
    background-color: #ffe;
    width: 40%;
    float: right;
}

p.sidebar-title {
    font-weight: bold;
}

/* -- topics ---------------------------------------------------------------- */

div.topic {
    border: 1px solid #ccc;
    padding: 7px 7px 0 7px;
    margin: 10px 0 10px 0;
}

p.topic-title {
    font-size: 1.1em;
    font-weight: bold;
    margin-top: 10px;
}

/* -- admonitions ----------------------------------------------------------- */

div.admonition {
    margin-top: 10px;
    margin-bottom: 10px;
    padding: 7px;
}

div.admonition dt {
    font-weight: bold;
}

div.admonition dl {
    margin-bottom: 0;
}

p.admonition-title {
    margin: 0px 10px 5px 0px;
    font-weight: bold;
}

div.document p.centered {
    text-align: center;
    margin-top: 25px;
}

/* -- tables ---------------------------------------------------------------- */

table.docutils {
    border: 0;
    border-collapse: collapse;
}

table.docutils td, table.docutils th {
    padding: 1px 8px 1px 5px;
    border-top: 0;
    border-left: 0;
    border-right: 0;
    border-bottom: 1px solid #aaa;
}

table.field-list td, table.field-list th {
    border: 0 !important;
}

table.footnote td, table.footnote th {
    border: 0 !important;
}

th {
    text-align: left;
    padding-right: 5px;
}

table.citation {
    border-left: solid 1px gray;
    margin-left: 1px;
}

table.citation td {
    border-bottom: none;
}

table.colwidths-auto caption {
    font-family: 'Inconsolata', monospace;
    font-weight: 800;
    font-size: 120%;
    padding: 5px;
    text-align: left;
    margin-bottom: 2px;
}

.section ol, .section li {
    margin: 0px 0px 0px 30px !important;
}

p.httpheaders {
    font-weight: 800;
    font-size: 120%;
    padding: 5px;
    text-align: left;
    margin-bottom: 2px;
}

table.colwidths-auto {
    width:100%;
    margin-top: 20px;
}

table.colwidths-auto tr td:nth-child(1) {
    width: 15%;
}

table.colwidths-auto tr td:nth-child(2) {
    width: 15%;
    font-family: 'Inconsolata', monospace;
}

table.colwidths-auto tr td:nth-child(3) {
    width: 70%;
}


/* -- other body styles ----------------------------------------------------- */

ol.arabic {
    list-style: decimal;
}

ol.loweralpha {
    list-style: lower-alpha;
}

ol.upperalpha {
    list-style: upper-alpha;
}

ol.lowerroman {
    list-style: lower-roman;
}

ol.upperroman {
    list-style: upper-roman;
}

dl {
    margin-bottom: 15px;
}

dd p {
    margin-top: 0px;
}

dd ul, dd table {
    margin-bottom: 10px;
}

dd {
    margin-top: 3px;
    margin-bottom: 10px;
    margin-left: 30px;
}

dt:target, .highlighted {
    background-color: #fbe54e;
}

dl.glossary dt {
    font-weight: bold;
    font-size: 1.1em;
}

.field-list ul {
    margin: 0;
    padding-left: 1em;
}

.field-list p {
    margin: 0;
}

.refcount {
    color: #060;
}

.optional {
    font-size: 1.3em;
}

.versionmodified {
    font-style: italic;
}

.system-message {
    background-color: #fda;
    padding: 5px;
    border: 3px solid red;
}

.footnote:target  {
    background-color: #ffa
}

.line-block {
    display: block;
    margin-top: 1em;
    margin-bottom: 1em;
}

.line-block .line-block {
    margin-top: 0;
    margin-bottom: 0;
    margin-left: 1.5em;
}

.guilabel, .menuselection {
    font-family: sans-serif;
}

.accelerator {
    text-decoration: underline;
}

.classifier {
    font-style: oblique;
}

/* -- proposals page -------------------------------------------------------- */

#tables-of-tracked-proposals h2 {
    padding-left: 10px;
    position: -webkit-sticky;
    position: sticky;
}

/* Move sticky headers below header bar on desktop */
@media all and (min-width:980px) {
    #tables-of-tracked-proposals h2 {
        top: 52px;
    }
}

/* Sticky headers stick to the top on mobile */
@media all and (min-width:0px) and (max-width: 980px) {
    #tables-of-tracked-proposals h2 {
        top: 0px;
    }
}

/* -- code displays --------------------------------------------------------- */

pre {
    overflow: auto;
}

td.linenos pre {
    padding: 5px 0px;
    border: 0;
    background-color: transparent;
    color: #aaa;
}

table.highlighttable {
    margin-left: 0.5em;
}

table.highlighttable td {
    padding: 0 0.5em 0 0.5em;
}

tt.descname {
    background-color: transparent;
    font-weight: bold;
    font-size: 1.2em;
}

tt.descclassname {
    background-color: transparent;
}

tt.xref, a tt {
    background-color: transparent;
    font-weight: bold;
}

h1 tt, h2 tt, h3 tt, h4 tt, h5 tt, h6 tt {
    background-color: transparent;
}

.viewcode-link {
    float: right;
}

.viewcode-back {
    float: right;
    font-family: sans-serif;
}

div.viewcode-block:target {
    margin: -1px -10px;
    padding: 0 10px;
}

/* -- math display ---------------------------------------------------------- */

img.math {
    vertical-align: middle;
}

div.document div.math p {
    text-align: center;
}

span.eqno {
    float: right;
}

/* -- printout stylesheet --------------------------------------------------- */

@media print {
    div.document,
    div.documentwrapper,
    div.bodywrapper {
        margin: 0 !important;
        width: 100%;
    }

    div.sphinxsidebar,
    div.related,
    div.footer,
    #top-link {
        display: none;
    }
}


</style>
<style type="text/css">

blockquote {
    margin: 20px 0 30px;
    padding-left: 20px;
}

</style>
<style type="text/css">

pre.code .comment, code .comment { color: green }
pre.code .keyword, code .keyword { color: darkred; font-weight: bold }
pre.code .name.builtin, code .name.builtin { color: darkred; font-weight: bold }
pre.code .name.tag, code .name.tag { color: darkgreen }
pre.code .literal, code .literal { color: darkblue }
pre.code .literal.number, code .literal.number { color: blue }


/* HTTP Methods have class "name function" */
pre.code.http .name.function,  code.http .name.function { color: black; font-weight: bold }
/* HTTP Paths have class "name namespace" */
pre.code.http .name.namespace, code.http .name.namespace { color: darkgreen }
/* HTTP "HTTP" strings have class "keyword reserved" */
pre.code.http .keyword.reserved, code.http .keyword.reserved { color: black; font-weight: bold }
/* HTTP Header names have class "name attribute" */
pre.code.http .name.attribute, code.http .name.attribute { color: black; font-weight: bold }

</style>
<style type="text/css">

/*
 * nature.css_t
 * ~~~~~~~~~~~~
 *
 * Sphinx stylesheet -- nature theme.
 *
 * :copyright: Copyright 2007-2010 by the Sphinx team, see AUTHORS.
 * :license: BSD, see LICENSE for details.
 *
 */

/* -- page layout ----------------------------------------------------------- */

body {
    font-family: Arial, sans-serif;
    font-size: 100%;
    /*background-color: #111;*/
    color: #555;
    margin: 0;
    padding: 0;
}

div.documentwrapper {
    float: left;
    width: 100%;
}

div.bodywrapper {
    margin: 0 0 0 230px;
}

hr {
    border: 1px solid #B1B4B6;
}

/*
div.document {
    background-color: #eee;
}
*/

div.document {
    background-color: #ffffff;
    color: #3E4349;
    padding: 0 30px 30px 30px;
    font-size: 0.9em;
}

div.footer {
    color: #555;
    width: 100%;
    padding: 13px 0;
    text-align: center;
    font-size: 75%;
}

div.footer a {
    color: #444;
    text-decoration: underline;
}

div.related {
    background-color: #6BA81E;
    line-height: 32px;
    color: #fff;
    text-shadow: 0px 1px 0 #444;
    font-size: 0.9em;
}

div.related a {
    color: #E2F3CC;
}

div.sphinxsidebar {
    font-size: 0.75em;
    line-height: 1.5em;
}

div.sphinxsidebarwrapper{
    padding: 20px 0;
}

div.sphinxsidebar h3,
div.sphinxsidebar h4 {
    font-family: Arial, sans-serif;
    color: #222;
    font-size: 1.2em;
    font-weight: normal;
    margin: 0;
    padding: 5px 10px;
    background-color: #ddd;
    text-shadow: 1px 1px 0 white
}

div.sphinxsidebar h4{
    font-size: 1.1em;
}

div.sphinxsidebar h3 a {
    color: #444;
}


div.sphinxsidebar p {
    color: #888;
    padding: 5px 20px;
}

div.sphinxsidebar p.topless {
}

div.sphinxsidebar ul {
    margin: 10px 20px;
    padding: 0;
    color: #000;
}

div.sphinxsidebar a {
    color: #444;
}

div.sphinxsidebar input {
    border: 1px solid #ccc;
    font-family: sans-serif;
    font-size: 1em;
}

div.sphinxsidebar input[type=text]{
    margin-left: 20px;
}

/* -- body styles ----------------------------------------------------------- */

a {
    color: #005B81;
    text-decoration: none;
}

a:hover {
    color: #E32E00;
    text-decoration: underline;
}

div.document h1,
div.document h2,
div.document h3,
div.document h4,
div.document h5,
div.document h6 {
    font-family: Arial, sans-serif;
    background-color: #BED4EB;
    font-weight: normal;
    color: #212224;
    margin: 30px 0px 10px 0px;
    padding: 5px 0 5px 10px;
    text-shadow: 0px 1px 0 white
}

div.document h1 { border-top: 20px solid white; margin-top: 0; font-size: 200%; }
div.document h2 { font-size: 150%; background-color: #C8D5E3; }
div.document h3 { font-size: 120%; background-color: #D8DEE3; }
div.document h4 { font-size: 110%; background-color: #D8DEE3; }
div.document h5 { font-size: 100%; background-color: #D8DEE3; }
div.document h6 { font-size: 100%; background-color: #D8DEE3; }

a.headerlink {
    color: #c60f0f;
    font-size: 0.8em;
    padding: 0 4px 0 4px;
    text-decoration: none;
}

a.headerlink:hover {
    background-color: #c60f0f;
    color: white;
}

div.document p, div.document dd, div.document li {
    line-height: 1.5em;
}

div.admonition p.admonition-title + p {
    display: inline;
}

div.highlight{
    background-color: white;
}

div.note {
    background-color: #eee;
    border: 1px solid #ccc;
}

div.seealso {
    background-color: #ffc;
    border: 1px solid #ff6;
}

div.topic {
    background-color: #eee;
}

div.warning {
    background-color: #ffe4e4;
    border: 1px solid #f66;
}

p.admonition-title {
    display: inline;
}

p.admonition-title:after {
    content: ":";
}

pre {
    padding: 10px;
    background-color: White;
    color: #222;
    line-height: 1.2em;
    border: 1px solid #C6C9CB;
    font-size: 1.1em;
    margin: 1.5em 0 1.5em 0;
    -webkit-box-shadow: 1px 1px 1px #d8d8d8;
    -moz-box-shadow: 1px 1px 1px #d8d8d8;
}

tt {
    background-color: #ecf0f3;
    color: #222;
    /* padding: 1px 2px; */
    font-size: 1.1em;
    font-family: monospace;
}

.viewcode-back {
    font-family: Arial, sans-serif;
}

div.viewcode-block:target {
    background-color: #f4debf;
    border-top: 1px solid #ac9;
    border-bottom: 1px solid #ac9;
}

ul li dd {
	margin-top: 0;
}

ul li dl {
	margin-bottom: 0;
}

li dl dd {
	margin-bottom: 0;
}

dd ul {
	padding-left: 0;
}

li dd ul {
	margin-bottom: 0;
}

table {
    margin-top: 10px;
    margin-bottom: 10px;
    border: 0;
    border-collapse: collapse;
}

td[colspan]:not([colspan="1"]) {
    background: #eeeeee;
    text-transform: capitalize;
}

thead {
    background: #eeeeee;
}

div.admonition-rationale {
    background-color: #efe;
    border: 1px solid #ccc;
}

div.admonition-example {
    background-color: #eef;
    border: 1px solid #ccc;
}


</style>
<style type="text/css">

/* Column with header cells */
table.docutils tbody th.stub {
    background: #eeeeee;
}

</style>
</head>
<body>
<div class="document" id="push-gateway-api">
<h1 class="title">Push Gateway API</h1>
%outdatedspecwarning%

<!-- Copyright 2016 OpenMarket Ltd -->
<!-- Copyright 2018 New Vector Ltd -->
<!--  -->
<!-- Licensed under the Apache License, Version 2.0 (the "License"); -->
<!-- you may not use this file except in compliance with the License. -->
<!-- You may obtain a copy of the License at -->
<!--  -->
<!-- http://www.apache.org/licenses/LICENSE-2.0 -->
<!--  -->
<!-- Unless required by applicable law or agreed to in writing, software -->
<!-- distributed under the License is distributed on an "AS IS" BASIS, -->
<!-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. -->
<!-- See the License for the specific language governing permissions and -->
<!-- limitations under the License. -->
<p>Clients may want to receive push notifications when events are received at
the homeserver. This is managed by a distinct entity called the Push Gateway.</p>
<div class="contents topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="auto-toc simple">
<li><a class="reference internal" href="#changelog" id="id2">1&nbsp;&nbsp;&nbsp;Changelog</a><ul class="auto-toc">
<li><a class="reference internal" href="#other-versions-of-this-specification" id="id3">1.1&nbsp;&nbsp;&nbsp;Other versions of this specification</a></li>
</ul>
</li>
<li><a class="reference internal" href="#overview" id="id4">2&nbsp;&nbsp;&nbsp;Overview</a></li>
<li><a class="reference internal" href="#homeserver-behaviour" id="id5">3&nbsp;&nbsp;&nbsp;Homeserver behaviour</a><ul class="auto-toc">
<li><a class="reference internal" href="#post-matrix-push-v1-notify" id="id6">3.1&nbsp;&nbsp;&nbsp;<tt class="docutils literal">POST /_matrix/push/v1/notify</tt></a></li>
</ul>
</li>
</ul>
</div>
<p><a class="anchor" id="changelog"></a></p>
<div class="section" id="changelog">
<h1><a class="toc-backref" href="#id2">1&nbsp;&nbsp;&nbsp;Changelog</a></h1>
<div class="topic">
<p class="topic-title first">Version: r0.1.1</p>
<p>Spec Clarifications</p>
<ul class="simple">
<li>Fix <tt class="docutils literal">event_id</tt> field in push request body. (<a class="reference external" href="https://github.com/matrix-org/matrix-doc/issues/2151">#2151</a>)</li>
</ul>
</div>
<p>This version of the specification is generated from
<a class="reference external" href="https://github.com/matrix-org/matrix-doc">matrix-doc</a> as of Git commit
<a class="reference external" href="https://github.com/matrix-org/matrix-doc/tree/40e6f82c">push_gateway/release-r0.1.1,40e6f82c</a>.</p>
<p>For the full historical changelog, see
<a class="reference external" href="https://github.com/matrix-org/matrix-doc/blob/main/changelogs/legacy/push_gateway.rst">https://github.com/matrix-org/matrix-doc/blob/main/changelogs/legacy/push_gateway.rst</a></p>
<p><a class="anchor" id="other-versions-of-this-specification"></a></p>
<div class="section" id="other-versions-of-this-specification">
<h2><a class="toc-backref" href="#id3">1.1&nbsp;&nbsp;&nbsp;Other versions of this specification</a></h2>
<p>The following other versions are also available, in reverse chronological order:</p>
<ul class="simple">
<li><a class="reference external" href="https://matrix.org/docs/spec/push_gateway/unstable.html">HEAD</a>: Includes all changes since the latest versioned release.</li>
<li><a class="reference external" href="https://matrix.org/docs/spec/push_gateway/r0.1.0.html">r0.1.0</a></li>
</ul>
</div>
</div>
<p><a class="anchor" id="overview"></a></p>
<div class="section" id="overview">
<h1><a class="toc-backref" href="#id4">2&nbsp;&nbsp;&nbsp;Overview</a></h1>
<p>A client's homeserver forwards information about received events to the push
gateway. The gateway then submits a push notification to the push notification
provider (e.g. APNS, GCM).</p>
<pre class="literal-block">
                                  +--------------------+  +-------------------+
                 Matrix HTTP      |                    |  |                   |
            Notification Protocol |   App Developer    |  |   Device Vendor   |
                                  |                    |  |                   |
          +-------------------+   | +----------------+ |  | +---------------+ |
          |                   |   | |                | |  | |               | |
          | Matrix homeserver +-----&gt;  Push Gateway  +------&gt; Push Provider | |
          |                   |   | |                | |  | |               | |
          +-^-----------------+   | +----------------+ |  | +----+----------+ |
            |                     |                    |  |      |            |
   Matrix   |                     |                    |  |      |            |
Client/Server API  +              |                    |  |      |            |
            |      |              +--------------------+  +-------------------+
            |   +--+-+                                           |
            |   |    &lt;-------------------------------------------+
            +---+    |
                |    |          Provider Push Protocol
                +----+

        Mobile Device or Client
</pre>
</div>
<p><a class="anchor" id="homeserver-behaviour"></a></p>
<div class="section" id="homeserver-behaviour">
<h1><a class="toc-backref" href="#id5">3&nbsp;&nbsp;&nbsp;Homeserver behaviour</a></h1>
<p>This describes the format used by &quot;HTTP&quot; pushers to send notifications of
events to Push Gateways. If the endpoint returns an HTTP error code, the
homeserver SHOULD retry for a reasonable amount of time using exponential backoff.</p>
<p>When pushing notifications for events, the homeserver is expected to include all of
the event-related fields in the <tt class="docutils literal">/notify</tt> request. When the homeserver is performing
a push where the <tt class="docutils literal">format</tt> is <tt class="docutils literal">&quot;event_id_only&quot;</tt>, only the <tt class="docutils literal">event_id</tt>, <tt class="docutils literal">room_id</tt>,
<tt class="docutils literal">counts</tt>, and <tt class="docutils literal">devices</tt> are required to be populated.</p>
<p><a class="anchor" id="post-matrix-push-v1-notify"></a></p>
<div class="section" id="post-matrix-push-v1-notify">
<h2><a class="toc-backref" href="#id6">3.1&nbsp;&nbsp;&nbsp;<tt class="docutils literal">POST /_matrix/push/v1/notify</tt></a></h2>
<p>This endpoint is invoked by HTTP pushers to notify a push gateway about
an event or update the number of unread notifications a user has.
In the former case it will contain selected information about the event.
In either case it may contain numeric counts of the number of unread
events of different types the user has. The counts may be sent along
with a notification about an event or by themselves.</p>
<p>Notifications about a particular event will normally cause the user to be
alerted in some way. It is therefore necessary to perform duplicate
suppression for such notifications using the <tt class="docutils literal">event_id</tt> field to avoid
retries of this HTTP API causing duplicate alerts. The operation of
updating counts of unread notifications should be idempotent and
therefore do not require duplicate suppression.</p>
<p>Notifications are sent to the URL configured when the pusher is created.
This means that the HTTP path may be different depending on the push
gateway.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Rate-limited:</th><td class="field-body">No.</td>
</tr>
<tr class="field"><th class="field-name">Requires auth:</th><td class="field-body">No.</td>
</tr>
</tbody>
</table>
<p class="httpheaders">Request format:</p>
<table border="1" class="colwidths-auto docutils">
<thead valign="bottom">
<tr><th class="head">Parameter</th>
<th class="head">Type</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr><td colspan="3"><em>JSON body parameters</em></td>
</tr>
<tr><td>notification</td>
<td>Notification</td>
<td><strong>Required.</strong> Information about the push
notification</td>
</tr>
</tbody>
</table>
<table border="1" class="colwidths-auto docutils">
<caption>Notification</caption>
<thead valign="bottom">
<tr><th class="head">Parameter</th>
<th class="head">Type</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>event_id</td>
<td>string</td>
<td>The Matrix event ID of the event being notified
about. This is required if the notification is
about a particular Matrix event. It may be omitted
for notifications that only contain updated badge
counts. This ID can and should be used to detect
duplicate notification requests.</td>
</tr>
<tr><td>room_id</td>
<td>string</td>
<td>The ID of the room in which this event occurred.
Required if the notification relates to a specific
Matrix event.</td>
</tr>
<tr><td>type</td>
<td>string</td>
<td>The type of the event as in the event's <tt class="docutils literal">type</tt>
field.</td>
</tr>
<tr><td>sender</td>
<td>string</td>
<td>The sender of the event as in the corresponding
event field.</td>
</tr>
<tr><td>sender_display_name</td>
<td>string</td>
<td>The current display name of the sender in the room
in which the event occurred.</td>
</tr>
<tr><td>room_name</td>
<td>string</td>
<td>The name of the room in which the event occurred.</td>
</tr>
<tr><td>room_alias</td>
<td>string</td>
<td>An alias to display for the room in which the
event occurred.</td>
</tr>
<tr><td>user_is_target</td>
<td>boolean</td>
<td>This is true if the user receiving the
notification is the subject of a member event
(i.e. the <tt class="docutils literal">state_key</tt> of the member event is
equal to the user's Matrix ID).</td>
</tr>
<tr><td>prio</td>
<td>enum</td>
<td>The priority of the notification. If omitted,
<tt class="docutils literal">high</tt> is assumed. This may be used by push
gateways to deliver less time-sensitive
notifications in a way that will preserve battery
power on mobile devices. One of: [&quot;high&quot;, &quot;low&quot;]</td>
</tr>
<tr><td>content</td>
<td>EventContent</td>
<td>The <tt class="docutils literal">content</tt> field from the event, if present.
The pusher may omit this if the event had no
content or for any other reason.</td>
</tr>
<tr><td>counts</td>
<td>Counts</td>
<td>This is a dictionary of the current number of
unacknowledged communications for the recipient
user. Counts whose value is zero should be
omitted.</td>
</tr>
<tr><td>devices</td>
<td>[Device]</td>
<td><strong>Required.</strong> This is an array of devices that the
notification should be sent to.</td>
</tr>
</tbody>
</table>
<table border="1" class="colwidths-auto docutils">
<caption>Counts</caption>
<thead valign="bottom">
<tr><th class="head">Parameter</th>
<th class="head">Type</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>unread</td>
<td>integer</td>
<td>The number of unread messages a user has across
all of the rooms they are a member of.</td>
</tr>
<tr><td>missed_calls</td>
<td>integer</td>
<td>The number of unacknowledged missed calls a user
has across all rooms of which they are a member.</td>
</tr>
</tbody>
</table>
<table border="1" class="colwidths-auto docutils">
<caption>Device</caption>
<thead valign="bottom">
<tr><th class="head">Parameter</th>
<th class="head">Type</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>app_id</td>
<td>string</td>
<td><strong>Required.</strong> The <tt class="docutils literal">app_id</tt> given when the pusher
was created.</td>
</tr>
<tr><td>pushkey</td>
<td>string</td>
<td><strong>Required.</strong> The <tt class="docutils literal">pushkey</tt> given when the
pusher was created.</td>
</tr>
<tr><td>pushkey_ts</td>
<td>integer</td>
<td>The unix timestamp (in seconds) when the pushkey
was last updated.</td>
</tr>
<tr><td>data</td>
<td>PusherData</td>
<td>A dictionary of additional pusher-specific data.
For 'http' pushers, this is the data dictionary
passed in at pusher creation minus the <tt class="docutils literal">url</tt>
key.</td>
</tr>
<tr><td>tweaks</td>
<td>Tweaks</td>
<td>A dictionary of customisations made to the way
this notification is to be presented. These are
added by push rules.</td>
</tr>
</tbody>
</table>
<p class="httpheaders">Response format:</p>
<table border="1" class="colwidths-auto docutils">
<thead valign="bottom">
<tr><th class="head">Parameter</th>
<th class="head">Type</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>rejected</td>
<td>[string]</td>
<td><strong>Required.</strong> A list of all pushkeys given in the
notification request that are not valid. These
could have been rejected by an upstream gateway
because they have expired or have never been
valid. Homeservers must cease sending notification
requests for these pushkeys and remove the
associated pushers. It may not necessarily be the
notification in the request that failed: it could
be that a previous notification to the same
pushkey failed. May be empty.</td>
</tr>
</tbody>
</table>
<p class="httpheaders">Example request:</p>
<pre class="code http literal-block">
<span class="name function">POST</span> <span class="name namespace">/_matrix/push/v1/notify</span> <span class="keyword reserved">HTTP</span><span class="operator">/</span><span class="literal number">1.1</span>
<span class="name attribute">Content-Type</span><span class="operator">:</span> <span class="literal">application/json</span>

<span class="punctuation">{</span>
  <span class="name tag">&quot;notification&quot;</span><span class="punctuation">:</span> <span class="punctuation">{</span>
    <span class="name tag">&quot;event_id&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;$3957tyerfgewrf384&quot;</span><span class="punctuation">,</span>
    <span class="name tag">&quot;room_id&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;!slw48wfj34rtnrf:example.com&quot;</span><span class="punctuation">,</span>
    <span class="name tag">&quot;type&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;m.room.message&quot;</span><span class="punctuation">,</span>
    <span class="name tag">&quot;sender&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;&#64;exampleuser:matrix.org&quot;</span><span class="punctuation">,</span>
    <span class="name tag">&quot;sender_display_name&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;Major Tom&quot;</span><span class="punctuation">,</span>
    <span class="name tag">&quot;room_name&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;Mission Control&quot;</span><span class="punctuation">,</span>
    <span class="name tag">&quot;room_alias&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;#exampleroom:matrix.org&quot;</span><span class="punctuation">,</span>
    <span class="name tag">&quot;prio&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;high&quot;</span><span class="punctuation">,</span>
    <span class="name tag">&quot;content&quot;</span><span class="punctuation">:</span> <span class="punctuation">{</span>
      <span class="name tag">&quot;msgtype&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;m.text&quot;</span><span class="punctuation">,</span>
      <span class="name tag">&quot;body&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;I'm floating in a most peculiar way.&quot;</span>
    <span class="punctuation">},</span>
    <span class="name tag">&quot;counts&quot;</span><span class="punctuation">:</span> <span class="punctuation">{</span>
      <span class="name tag">&quot;unread&quot;</span><span class="punctuation">:</span> <span class="literal number integer">2</span><span class="punctuation">,</span>
      <span class="name tag">&quot;missed_calls&quot;</span><span class="punctuation">:</span> <span class="literal number integer">1</span>
    <span class="punctuation">},</span>
    <span class="name tag">&quot;devices&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span>
      <span class="punctuation">{</span>
        <span class="name tag">&quot;app_id&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;org.matrix.matrixConsole.ios&quot;</span><span class="punctuation">,</span>
        <span class="name tag">&quot;pushkey&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;V2h5IG9uIGVhcnRoIGRpZCB5b3UgZGVjb2RlIHRoaXM/&quot;</span><span class="punctuation">,</span>
        <span class="name tag">&quot;pushkey_ts&quot;</span><span class="punctuation">:</span> <span class="literal number integer">12345678</span><span class="punctuation">,</span>
        <span class="name tag">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">{},</span>
        <span class="name tag">&quot;tweaks&quot;</span><span class="punctuation">:</span> <span class="punctuation">{</span>
          <span class="name tag">&quot;sound&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;bing&quot;</span>
        <span class="punctuation">}</span>
      <span class="punctuation">}</span>
    <span class="punctuation">]</span>
  <span class="punctuation">}</span>
<span class="punctuation">}</span>
</pre>
<p class="httpheaders">Response:</p>
<p><strong>Status code 200:</strong></p>
<p>A list of rejected push keys.</p>
<p class="httpheaders">Example</p>
<pre class="code json literal-block">
<span class="punctuation">{</span>
  <span class="name tag">&quot;rejected&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span>
    <span class="literal string double">&quot;V2h5IG9uIGVhcnRoIGRpZCB5b3UgZGVjb2RlIHRoaXM/&quot;</span>
  <span class="punctuation">]</span>
<span class="punctuation">}</span>
</pre>
</div>
</div>
</div>
</body>
</html>
