<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.16: http://docutils.sourceforge.net/" />
<title>Matrix Specification</title>
<style type="text/css">

/*
 * basic.css
 * ~~~~~~~~~
 *
 * Sphinx stylesheet -- basic theme.
 *
 * :copyright: Copyright 2007-2010 by the Sphinx team, see AUTHORS.
 * :license: BSD, see LICENSE for details.
 *
 */

/* -- main layout ----------------------------------------------------------- */

div.clearer {
    clear: both;
}

/* -- relbar ---------------------------------------------------------------- */

div.related {
    width: 100%;
    font-size: 90%;
}

div.related h3 {
    display: none;
}

div.related ul {
    margin: 0;
    padding: 0 0 0 10px;
    list-style: none;
}

div.related li {
    display: inline;
}

div.related li.right {
    float: right;
    margin-right: 5px;
}

/* -- sidebar --------------------------------------------------------------- */

div.sphinxsidebarwrapper {
    padding: 10px 5px 0 10px;
}

div.sphinxsidebar {
    float: left;
    width: 230px;
    margin-left: -100%;
    font-size: 90%;
}

div.sphinxsidebar ul {
    list-style: none;
}

div.sphinxsidebar ul ul,
div.sphinxsidebar ul.want-points {
    margin-left: 20px;
    list-style: square;
}

div.sphinxsidebar ul ul {
    margin-top: 0;
    margin-bottom: 0;
}

div.sphinxsidebar form {
    margin-top: 10px;
}

div.sphinxsidebar input {
    border: 1px solid #98dbcc;
    font-family: sans-serif;
    font-size: 1em;
}

img {
    border: 0;
}

/* -- search page ----------------------------------------------------------- */

ul.search {
    margin: 10px 0 0 20px;
    padding: 0;
}

ul.search li {
    padding: 5px 0 5px 20px;
    background-image: url(file.png);
    background-repeat: no-repeat;
    background-position: 0 7px;
}

ul.search li a {
    font-weight: bold;
}

ul.search li div.context {
    color: #888;
    margin: 2px 0 0 30px;
    text-align: left;
}

ul.keywordmatches li.goodmatch a {
    font-weight: bold;
}

/* -- index page ------------------------------------------------------------ */

table.contentstable {
    width: 90%;
}

table.contentstable p.biglink {
    line-height: 150%;
}

a.biglink {
    font-size: 1.3em;
}

span.linkdescr {
    font-style: italic;
    padding-top: 5px;
    font-size: 90%;
}

/* -- general index --------------------------------------------------------- */

table.indextable {
    width: 100%;
}

table.indextable td {
    text-align: left;
    vertical-align: top;
}

table.indextable dl, table.indextable dd {
    margin-top: 0;
    margin-bottom: 0;
}

table.indextable tr.pcap {
    height: 10px;
}

table.indextable tr.cap {
    margin-top: 10px;
    background-color: #f2f2f2;
}

img.toggler {
    margin-right: 3px;
    margin-top: 3px;
    cursor: pointer;
}

div.modindex-jumpbox {
    border-top: 1px solid #ddd;
    border-bottom: 1px solid #ddd;
    margin: 1em 0 1em 0;
    padding: 0.4em;
}

div.genindex-jumpbox {
    border-top: 1px solid #ddd;
    border-bottom: 1px solid #ddd;
    margin: 1em 0 1em 0;
    padding: 0.4em;
}

/* -- general body styles --------------------------------------------------- */

a.headerlink {
    visibility: hidden;
}

h1:hover > a.headerlink,
h2:hover > a.headerlink,
h3:hover > a.headerlink,
h4:hover > a.headerlink,
h5:hover > a.headerlink,
h6:hover > a.headerlink,
dt:hover > a.headerlink {
    visibility: visible;
}

div.document p.caption {
    text-align: inherit;
}

div.document td {
    text-align: left;
}

.field-list ul {
    padding-left: 1em;
}

.first {
    margin-top: 0 !important;
}

p.rubric {
    margin-top: 30px;
    font-weight: bold;
}

.align-left {
    text-align: left;
}

.align-center {
    clear: both;
    text-align: center;
}

.align-right {
    text-align: right;
}

/* -- sidebars -------------------------------------------------------------- */

div.sidebar {
    margin: 0 0 0.5em 1em;
    border: 1px solid #ddb;
    padding: 7px 7px 0 7px;
    background-color: #ffe;
    width: 40%;
    float: right;
}

p.sidebar-title {
    font-weight: bold;
}

/* -- topics ---------------------------------------------------------------- */

div.topic {
    border: 1px solid #ccc;
    padding: 7px 7px 0 7px;
    margin: 10px 0 10px 0;
}

p.topic-title {
    font-size: 1.1em;
    font-weight: bold;
    margin-top: 10px;
}

/* -- admonitions ----------------------------------------------------------- */

div.admonition {
    margin-top: 10px;
    margin-bottom: 10px;
    padding: 7px;
}

div.admonition dt {
    font-weight: bold;
}

div.admonition dl {
    margin-bottom: 0;
}

p.admonition-title {
    margin: 0px 10px 5px 0px;
    font-weight: bold;
}

div.document p.centered {
    text-align: center;
    margin-top: 25px;
}

/* -- tables ---------------------------------------------------------------- */

table.docutils {
    border: 0;
    border-collapse: collapse;
}

table.docutils td, table.docutils th {
    padding: 1px 8px 1px 5px;
    border-top: 0;
    border-left: 0;
    border-right: 0;
    border-bottom: 1px solid #aaa;
}

table.field-list td, table.field-list th {
    border: 0 !important;
}

table.footnote td, table.footnote th {
    border: 0 !important;
}

th {
    text-align: left;
    padding-right: 5px;
}

table.citation {
    border-left: solid 1px gray;
    margin-left: 1px;
}

table.citation td {
    border-bottom: none;
}

table.colwidths-auto caption {
    font-family: 'Inconsolata', monospace;
    font-weight: 800;
    font-size: 120%;
    padding: 5px;
    text-align: left;
    margin-bottom: 2px;
}

.section ol, .section li {
    margin: 0px 0px 0px 30px !important;
}

p.httpheaders {
    font-weight: 800;
    font-size: 120%;
    padding: 5px;
    text-align: left;
    margin-bottom: 2px;
}

table.colwidths-auto {
    width:100%;
    margin-top: 20px;
}

table.colwidths-auto tr td:nth-child(1) {
    width: 15%;
}

table.colwidths-auto tr td:nth-child(2) {
    width: 15%;
    font-family: 'Inconsolata', monospace;
}

table.colwidths-auto tr td:nth-child(3) {
    width: 70%;
}


/* -- other body styles ----------------------------------------------------- */

ol.arabic {
    list-style: decimal;
}

ol.loweralpha {
    list-style: lower-alpha;
}

ol.upperalpha {
    list-style: upper-alpha;
}

ol.lowerroman {
    list-style: lower-roman;
}

ol.upperroman {
    list-style: upper-roman;
}

dl {
    margin-bottom: 15px;
}

dd p {
    margin-top: 0px;
}

dd ul, dd table {
    margin-bottom: 10px;
}

dd {
    margin-top: 3px;
    margin-bottom: 10px;
    margin-left: 30px;
}

dt:target, .highlighted {
    background-color: #fbe54e;
}

dl.glossary dt {
    font-weight: bold;
    font-size: 1.1em;
}

.field-list ul {
    margin: 0;
    padding-left: 1em;
}

.field-list p {
    margin: 0;
}

.refcount {
    color: #060;
}

.optional {
    font-size: 1.3em;
}

.versionmodified {
    font-style: italic;
}

.system-message {
    background-color: #fda;
    padding: 5px;
    border: 3px solid red;
}

.footnote:target  {
    background-color: #ffa
}

.line-block {
    display: block;
    margin-top: 1em;
    margin-bottom: 1em;
}

.line-block .line-block {
    margin-top: 0;
    margin-bottom: 0;
    margin-left: 1.5em;
}

.guilabel, .menuselection {
    font-family: sans-serif;
}

.accelerator {
    text-decoration: underline;
}

.classifier {
    font-style: oblique;
}

/* -- proposals page -------------------------------------------------------- */

#tables-of-tracked-proposals h2 {
    padding-left: 10px;
    position: -webkit-sticky;
    position: sticky;
}

/* Move sticky headers below header bar on desktop */
@media all and (min-width:980px) {
    #tables-of-tracked-proposals h2 {
        top: 52px;
    }
}

/* Sticky headers stick to the top on mobile */
@media all and (min-width:0px) and (max-width: 980px) {
    #tables-of-tracked-proposals h2 {
        top: 0px;
    }
}

/* -- code displays --------------------------------------------------------- */

pre {
    overflow: auto;
}

td.linenos pre {
    padding: 5px 0px;
    border: 0;
    background-color: transparent;
    color: #aaa;
}

table.highlighttable {
    margin-left: 0.5em;
}

table.highlighttable td {
    padding: 0 0.5em 0 0.5em;
}

tt.descname {
    background-color: transparent;
    font-weight: bold;
    font-size: 1.2em;
}

tt.descclassname {
    background-color: transparent;
}

tt.xref, a tt {
    background-color: transparent;
    font-weight: bold;
}

h1 tt, h2 tt, h3 tt, h4 tt, h5 tt, h6 tt {
    background-color: transparent;
}

.viewcode-link {
    float: right;
}

.viewcode-back {
    float: right;
    font-family: sans-serif;
}

div.viewcode-block:target {
    margin: -1px -10px;
    padding: 0 10px;
}

/* -- math display ---------------------------------------------------------- */

img.math {
    vertical-align: middle;
}

div.document div.math p {
    text-align: center;
}

span.eqno {
    float: right;
}

/* -- printout stylesheet --------------------------------------------------- */

@media print {
    div.document,
    div.documentwrapper,
    div.bodywrapper {
        margin: 0 !important;
        width: 100%;
    }

    div.sphinxsidebar,
    div.related,
    div.footer,
    #top-link {
        display: none;
    }
}


</style>
<style type="text/css">

blockquote {
    margin: 20px 0 30px;
    padding-left: 20px;
}

</style>
<style type="text/css">

pre.code .comment, code .comment { color: green }
pre.code .keyword, code .keyword { color: darkred; font-weight: bold }
pre.code .name.builtin, code .name.builtin { color: darkred; font-weight: bold }
pre.code .name.tag, code .name.tag { color: darkgreen }
pre.code .literal, code .literal { color: darkblue }
pre.code .literal.number, code .literal.number { color: blue }


/* HTTP Methods have class "name function" */
pre.code.http .name.function,  code.http .name.function { color: black; font-weight: bold }
/* HTTP Paths have class "name namespace" */
pre.code.http .name.namespace, code.http .name.namespace { color: darkgreen }
/* HTTP "HTTP" strings have class "keyword reserved" */
pre.code.http .keyword.reserved, code.http .keyword.reserved { color: black; font-weight: bold }
/* HTTP Header names have class "name attribute" */
pre.code.http .name.attribute, code.http .name.attribute { color: black; font-weight: bold }

</style>
<style type="text/css">

/*
 * nature.css_t
 * ~~~~~~~~~~~~
 *
 * Sphinx stylesheet -- nature theme.
 *
 * :copyright: Copyright 2007-2010 by the Sphinx team, see AUTHORS.
 * :license: BSD, see LICENSE for details.
 *
 */

/* -- page layout ----------------------------------------------------------- */

body {
    font-family: Arial, sans-serif;
    font-size: 100%;
    /*background-color: #111;*/
    color: #555;
    margin: 0;
    padding: 0;
}

div.documentwrapper {
    float: left;
    width: 100%;
}

div.bodywrapper {
    margin: 0 0 0 230px;
}

hr {
    border: 1px solid #B1B4B6;
}

/*
div.document {
    background-color: #eee;
}
*/

div.document {
    background-color: #ffffff;
    color: #3E4349;
    padding: 0 30px 30px 30px;
    font-size: 0.9em;
}

div.footer {
    color: #555;
    width: 100%;
    padding: 13px 0;
    text-align: center;
    font-size: 75%;
}

div.footer a {
    color: #444;
    text-decoration: underline;
}

div.related {
    background-color: #6BA81E;
    line-height: 32px;
    color: #fff;
    text-shadow: 0px 1px 0 #444;
    font-size: 0.9em;
}

div.related a {
    color: #E2F3CC;
}

div.sphinxsidebar {
    font-size: 0.75em;
    line-height: 1.5em;
}

div.sphinxsidebarwrapper{
    padding: 20px 0;
}

div.sphinxsidebar h3,
div.sphinxsidebar h4 {
    font-family: Arial, sans-serif;
    color: #222;
    font-size: 1.2em;
    font-weight: normal;
    margin: 0;
    padding: 5px 10px;
    background-color: #ddd;
    text-shadow: 1px 1px 0 white
}

div.sphinxsidebar h4{
    font-size: 1.1em;
}

div.sphinxsidebar h3 a {
    color: #444;
}


div.sphinxsidebar p {
    color: #888;
    padding: 5px 20px;
}

div.sphinxsidebar p.topless {
}

div.sphinxsidebar ul {
    margin: 10px 20px;
    padding: 0;
    color: #000;
}

div.sphinxsidebar a {
    color: #444;
}

div.sphinxsidebar input {
    border: 1px solid #ccc;
    font-family: sans-serif;
    font-size: 1em;
}

div.sphinxsidebar input[type=text]{
    margin-left: 20px;
}

/* -- body styles ----------------------------------------------------------- */

a {
    color: #005B81;
    text-decoration: none;
}

a:hover {
    color: #E32E00;
    text-decoration: underline;
}

div.document h1,
div.document h2,
div.document h3,
div.document h4,
div.document h5,
div.document h6 {
    font-family: Arial, sans-serif;
    background-color: #BED4EB;
    font-weight: normal;
    color: #212224;
    margin: 30px 0px 10px 0px;
    padding: 5px 0 5px 10px;
    text-shadow: 0px 1px 0 white
}

div.document h1 { border-top: 20px solid white; margin-top: 0; font-size: 200%; }
div.document h2 { font-size: 150%; background-color: #C8D5E3; }
div.document h3 { font-size: 120%; background-color: #D8DEE3; }
div.document h4 { font-size: 110%; background-color: #D8DEE3; }
div.document h5 { font-size: 100%; background-color: #D8DEE3; }
div.document h6 { font-size: 100%; background-color: #D8DEE3; }

a.headerlink {
    color: #c60f0f;
    font-size: 0.8em;
    padding: 0 4px 0 4px;
    text-decoration: none;
}

a.headerlink:hover {
    background-color: #c60f0f;
    color: white;
}

div.document p, div.document dd, div.document li {
    line-height: 1.5em;
}

div.admonition p.admonition-title + p {
    display: inline;
}

div.highlight{
    background-color: white;
}

div.note {
    background-color: #eee;
    border: 1px solid #ccc;
}

div.seealso {
    background-color: #ffc;
    border: 1px solid #ff6;
}

div.topic {
    background-color: #eee;
}

div.warning {
    background-color: #ffe4e4;
    border: 1px solid #f66;
}

p.admonition-title {
    display: inline;
}

p.admonition-title:after {
    content: ":";
}

pre {
    padding: 10px;
    background-color: White;
    color: #222;
    line-height: 1.2em;
    border: 1px solid #C6C9CB;
    font-size: 1.1em;
    margin: 1.5em 0 1.5em 0;
    -webkit-box-shadow: 1px 1px 1px #d8d8d8;
    -moz-box-shadow: 1px 1px 1px #d8d8d8;
}

tt {
    background-color: #ecf0f3;
    color: #222;
    /* padding: 1px 2px; */
    font-size: 1.1em;
    font-family: monospace;
}

.viewcode-back {
    font-family: Arial, sans-serif;
}

div.viewcode-block:target {
    background-color: #f4debf;
    border-top: 1px solid #ac9;
    border-bottom: 1px solid #ac9;
}

ul li dd {
	margin-top: 0;
}

ul li dl {
	margin-bottom: 0;
}

li dl dd {
	margin-bottom: 0;
}

dd ul {
	padding-left: 0;
}

li dd ul {
	margin-bottom: 0;
}

table {
    margin-top: 10px;
    margin-bottom: 10px;
    border: 0;
    border-collapse: collapse;
}

td[colspan]:not([colspan="1"]) {
    background: #eeeeee;
    text-transform: capitalize;
}

thead {
    background: #eeeeee;
}

div.admonition-rationale {
    background-color: #efe;
    border: 1px solid #ccc;
}

div.admonition-example {
    background-color: #eef;
    border: 1px solid #ccc;
}


</style>
<style type="text/css">

/*
Original styles generated from:
    pygmentize -f html -S colorful -a pre.code > ./scripts/css/pygments.css

Rules for which we don't want the syntax highlighter to kick in are commented
out at the bottom.

Windows users: if you regenerate this file, you'll need to re-save it as utf-8
to make docutils happy.
*/

/* DIFFS */
pre.code .gd { color: #A00000 } /* Generic.Deleted */
pre.code .gi { color: #00A000 } /* Generic.Inserted */

/* UNUSED */
/*pre.code .hll { background-color: #ffffcc }*/
/*pre.code  { background: #ffffff; }*/
/*pre.code .c { color: #888888 } !* Comment *!*/
/*pre.code .err { color: #FF0000; background-color: #FFAAAA } !* Error *!*/
/*pre.code .k { color: #008800; font-weight: bold } !* Keyword *!*/
/*pre.code .o { color: #333333 } !* Operator *!*/
/*pre.code .ch { color: #888888 } !* Comment.Hashbang *!*/
/*pre.code .cm { color: #888888 } !* Comment.Multiline *!*/
/*pre.code .cp { color: #557799 } !* Comment.Preproc *!*/
/*pre.code .cpf { color: #888888 } !* Comment.PreprocFile *!*/
/*pre.code .c1 { color: #888888 } !* Comment.Single *!*/
/*pre.code .cs { color: #cc0000; font-weight: bold } !* Comment.Special *!*/
/*pre.code .ge { font-style: italic } !* Generic.Emph *!*/
/*pre.code .gr { color: #FF0000 } !* Generic.Error *!*/
/*pre.code .gh { color: #000080; font-weight: bold } !* Generic.Heading *!*/
/*pre.code .go { color: #888888 } !* Generic.Output *!*/
/*pre.code .gp { color: #c65d09; font-weight: bold } !* Generic.Prompt *!*/
/*pre.code .gs { font-weight: bold } !* Generic.Strong *!*/
/*pre.code .gu { color: #800080; font-weight: bold } !* Generic.Subheading *!*/
/*pre.code .gt { color: #0044DD } !* Generic.Traceback *!*/
/*pre.code .kc { color: #008800; font-weight: bold } !* Keyword.Constant *!*/
/*pre.code .kd { color: #008800; font-weight: bold } !* Keyword.Declaration *!*/
/*pre.code .kn { color: #008800; font-weight: bold } !* Keyword.Namespace *!*/
/*pre.code .kp { color: #003388; font-weight: bold } !* Keyword.Pseudo *!*/
/*pre.code .kr { color: #008800; font-weight: bold } !* Keyword.Reserved *!*/
/*pre.code .kt { color: #333399; font-weight: bold } !* Keyword.Type *!*/
/*pre.code .m { color: #6600EE; font-weight: bold } !* Literal.Number *!*/
/*pre.code .s { background-color: #fff0f0 } !* Literal.String *!*/
/*pre.code .na { color: #0000CC } !* Name.Attribute *!*/
/*pre.code .nb { color: #007020 } !* Name.Builtin *!*/
/*pre.code .nc { color: #BB0066; font-weight: bold } !* Name.Class *!*/
/*pre.code .no { color: #003366; font-weight: bold } !* Name.Constant *!*/
/*pre.code .nd { color: #555555; font-weight: bold } !* Name.Decorator *!*/
/*pre.code .ni { color: #880000; font-weight: bold } !* Name.Entity *!*/
/*pre.code .ne { color: #FF0000; font-weight: bold } !* Name.Exception *!*/
/*pre.code .nf { color: #0066BB; font-weight: bold } !* Name.Function *!*/
/*pre.code .nl { color: #997700; font-weight: bold } !* Name.Label *!*/
/*pre.code .nn { color: #0e84b5; font-weight: bold } !* Name.Namespace *!*/
/*pre.code .nt { color: #007700 } !* Name.Tag *!*/
/*pre.code .nv { color: #996633 } !* Name.Variable *!*/
/*pre.code .ow { color: #000000; font-weight: bold } !* Operator.Word *!*/
/*pre.code .w { color: #bbbbbb } !* Text.Whitespace *!*/
/*pre.code .mb { color: #6600EE; font-weight: bold } !* Literal.Number.Bin *!*/
/*pre.code .mf { color: #6600EE; font-weight: bold } !* Literal.Number.Float *!*/
/*pre.code .mh { color: #005588; font-weight: bold } !* Literal.Number.Hex *!*/
/*pre.code .mi { color: #0000DD; font-weight: bold } !* Literal.Number.Integer *!*/
/*pre.code .mo { color: #4400EE; font-weight: bold } !* Literal.Number.Oct *!*/
/*pre.code .sa { background-color: #fff0f0 } !* Literal.String.Affix *!*/
/*pre.code .sb { background-color: #fff0f0 } !* Literal.String.Backtick *!*/
/*pre.code .sc { color: #0044DD } !* Literal.String.Char *!*/
/*pre.code .dl { background-color: #fff0f0 } !* Literal.String.Delimiter *!*/
/*pre.code .sd { color: #DD4422 } !* Literal.String.Doc *!*/
/*pre.code .s2 { background-color: #fff0f0 } !* Literal.String.Double *!*/
/*pre.code .se { color: #666666; font-weight: bold; background-color: #fff0f0 } !* Literal.String.Escape *!*/
/*pre.code .sh { background-color: #fff0f0 } !* Literal.String.Heredoc *!*/
/*pre.code .si { background-color: #eeeeee } !* Literal.String.Interpol *!*/
/*pre.code .sx { color: #DD2200; background-color: #fff0f0 } !* Literal.String.Other *!*/
/*pre.code .sr { color: #000000; background-color: #fff0ff } !* Literal.String.Regex *!*/
/*pre.code .s1 { background-color: #fff0f0 } !* Literal.String.Single *!*/
/*pre.code .ss { color: #AA6600 } !* Literal.String.Symbol *!*/
/*pre.code .bp { color: #007020 } !* Name.Builtin.Pseudo *!*/
/*pre.code .fm { color: #0066BB; font-weight: bold } !* Name.Function.Magic *!*/
/*pre.code .vc { color: #336699 } !* Name.Variable.Class *!*/
/*pre.code .vg { color: #dd7700; font-weight: bold } !* Name.Variable.Global *!*/
/*pre.code .vi { color: #3333BB } !* Name.Variable.Instance *!*/
/*pre.code .vm { color: #996633 } !* Name.Variable.Magic *!*/
/*pre.code .il { color: #0000DD; font-weight: bold } !* Literal.Number.Integer.Long *!*/

</style>
<style type="text/css">

/* Column with header cells */
table.docutils tbody th.stub {
    background: #eeeeee;
}

</style>
</head>
<body>
<div class="document" id="matrix-specification">
<h1 class="title">Matrix Specification</h1>
%outdatedspecwarning%

<!-- Copyright 2016 OpenMarket Ltd -->
<!--  -->
<!-- Licensed under the Apache License, Version 2.0 (the "License"); -->
<!-- you may not use this file except in compliance with the License. -->
<!-- You may obtain a copy of the License at -->
<!--  -->
<!-- http://www.apache.org/licenses/LICENSE-2.0 -->
<!--  -->
<!-- Unless required by applicable law or agreed to in writing, software -->
<!-- distributed under the License is distributed on an "AS IS" BASIS, -->
<!-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. -->
<!-- See the License for the specific language governing permissions and -->
<!-- limitations under the License. -->
<!-- Note that this file is specifically unversioned because we don't want to -->
<!-- have to add Yet Another version number, and the commentary on what specs we -->
<!-- have should hopefully not get complex enough that we need to worry about -->
<!-- versioning it. -->
<p>Matrix defines a set of open APIs for decentralised communication, suitable for
securely publishing, persisting and subscribing to data over a global open
federation of servers with no single point of control.  Uses include Instant Messaging (IM),
Voice over IP (VoIP) signalling, Internet of Things (IoT) communication, and bridging
together existing communication silos - providing the basis of a new open real-time
communication ecosystem.</p>
<p>To propose a change to the Matrix Spec, see the explanations at
<a class="reference external" href="proposals">Proposals for Spec Changes to Matrix</a>.</p>
<div class="contents topic" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="auto-toc simple">
<li><a class="reference internal" href="#matrix-apis" id="id6">1&nbsp;&nbsp;&nbsp;Matrix APIs</a><ul class="auto-toc">
<li><a class="reference internal" href="#matrix-versions" id="id7">1.1&nbsp;&nbsp;&nbsp;Matrix versions</a></li>
</ul>
</li>
<li><a class="reference internal" href="#introduction-to-the-matrix-apis" id="id8">2&nbsp;&nbsp;&nbsp;Introduction to the Matrix APIs</a><ul class="auto-toc">
<li><a class="reference internal" href="#spec-change-proposals" id="id9">2.1&nbsp;&nbsp;&nbsp;Spec Change Proposals</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id2" id="id10">3&nbsp;&nbsp;&nbsp;Architecture</a><ul class="auto-toc">
<li><a class="reference internal" href="#users" id="id11">3.1&nbsp;&nbsp;&nbsp;Users</a></li>
<li><a class="reference internal" href="#devices" id="id12">3.2&nbsp;&nbsp;&nbsp;Devices</a></li>
<li><a class="reference internal" href="#events" id="id13">3.3&nbsp;&nbsp;&nbsp;Events</a></li>
<li><a class="reference internal" href="#event-graphs" id="id14">3.4&nbsp;&nbsp;&nbsp;Event Graphs</a></li>
<li><a class="reference internal" href="#room-structure" id="id15">3.5&nbsp;&nbsp;&nbsp;Room structure</a><ul class="auto-toc">
<li><a class="reference internal" href="#room-aliases" id="id16">3.5.1&nbsp;&nbsp;&nbsp;Room Aliases</a></li>
</ul>
</li>
<li><a class="reference internal" href="#identity" id="id17">3.6&nbsp;&nbsp;&nbsp;Identity</a></li>
<li><a class="reference internal" href="#profiles" id="id18">3.7&nbsp;&nbsp;&nbsp;Profiles</a></li>
<li><a class="reference internal" href="#private-user-data" id="id19">3.8&nbsp;&nbsp;&nbsp;Private User Data</a></li>
</ul>
</li>
<li><a class="reference internal" href="#common-concepts" id="id20">4&nbsp;&nbsp;&nbsp;Common concepts</a><ul class="auto-toc">
<li><a class="reference internal" href="#namespacing" id="id21">4.1&nbsp;&nbsp;&nbsp;Namespacing</a></li>
<li><a class="reference internal" href="#timestamps" id="id22">4.2&nbsp;&nbsp;&nbsp;Timestamps</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id5" id="id23">5&nbsp;&nbsp;&nbsp;Room Versions</a><ul class="auto-toc">
<li><a class="reference internal" href="#room-version-grammar" id="id24">5.1&nbsp;&nbsp;&nbsp;Room version grammar</a></li>
<li><a class="reference internal" href="#complete-list-of-room-versions" id="id25">5.2&nbsp;&nbsp;&nbsp;Complete list of room versions</a></li>
</ul>
</li>
<li><a class="reference internal" href="#specification-versions" id="id26">6&nbsp;&nbsp;&nbsp;Specification Versions</a></li>
<li><a class="reference internal" href="#license" id="id27">7&nbsp;&nbsp;&nbsp;License</a></li>
</ul>
</div>
<p><a class="anchor" id="matrix-apis"></a></p>
<div class="section" id="matrix-apis">
<h1><a class="toc-backref" href="#id6">1&nbsp;&nbsp;&nbsp;Matrix APIs</a></h1>
<p>The specification consists of the following parts:</p>
<table border="1" class="colwidths-auto docutils">
<thead valign="bottom">
<tr><th class="head">API</th>
<th class="head">Version</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr><td><a class="reference external" href="client_server/r0.6.1.html">Client-Server API</a></td>
<td>r0.6.1</td>
<td>Interaction between clients and servers</td>
</tr>
<tr><td><a class="reference external" href="server_server/r0.1.4.html">Server-Server API</a></td>
<td>r0.1.4</td>
<td>Federation between servers</td>
</tr>
<tr><td><a class="reference external" href="application_service/r0.1.2.html">Application Service API</a></td>
<td>r0.1.2</td>
<td>Privileged server plugins</td>
</tr>
<tr><td><a class="reference external" href="identity_service/r0.3.0.html">Identity Service API</a></td>
<td>r0.3.0</td>
<td>Mapping of third party IDs to Matrix IDs</td>
</tr>
<tr><td><a class="reference external" href="push_gateway/r0.1.1.html">Push Gateway API</a></td>
<td>r0.1.1</td>
<td>Push notifications for Matrix events</td>
</tr>
</tbody>
</table>
<p>Additionally, this introduction page contains the key baseline information required to
understand the specific APIs, including the sections on <a class="reference internal" href="#room-versions">room versions</a>
and <a class="reference external" href="#architecture">overall architecture</a>.</p>
<p>The <a class="reference external" href="appendices.html">Appendices</a> contain supplemental information not specific to
one of the above APIs.</p>
<p>The <a class="reference external" href="https://matrix.org/docs/api/">Matrix OpenAPI Viewer</a>
is useful for browsing the Client-Server API.</p>
<p><a class="anchor" id="matrix-versions"></a></p>
<div class="section" id="matrix-versions">
<h2><a class="toc-backref" href="#id7">1.1&nbsp;&nbsp;&nbsp;Matrix versions</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">As of June 10th 2019, the Matrix specification is considered out of beta -
indicating that all currently released APIs are considered stable and secure
to the best of our knowledge, and the spec should contain the complete
information necessary to develop production-grade implementations of Matrix
without the need for external reference.</p>
</div>
<p>Matrix 1.0 (released June 10th, 2019) consists of the following minimum API
versions:</p>
<table border="1" class="docutils">
<colgroup>
<col width="77%" />
<col width="23%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">API/Specification</th>
<th class="head">Version</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>Client-Server API</td>
<td>r0.5.0</td>
</tr>
<tr><td>Server-Server API</td>
<td>r0.1.2</td>
</tr>
<tr><td>Application Service API</td>
<td>r0.1.1</td>
</tr>
<tr><td>Identity Service API</td>
<td>r0.1.1</td>
</tr>
<tr><td>Push Gateway API</td>
<td>r0.1.0</td>
</tr>
<tr><td>Room Version</td>
<td>v5</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><a class="anchor" id="introduction-to-the-matrix-apis"></a></p>
<div class="section" id="introduction-to-the-matrix-apis">
<h1><a class="toc-backref" href="#id8">2&nbsp;&nbsp;&nbsp;Introduction to the Matrix APIs</a></h1>
<p>Matrix is a set of open APIs for open-federated Instant Messaging (IM), Voice
over IP (VoIP) and Internet of Things (IoT) communication, designed to create
and support a new global real-time communication ecosystem. The intention is to
provide an open decentralised pubsub layer for the internet for securely
persisting and publishing/subscribing JSON objects. This specification is the
ongoing result of standardising the APIs used by the various components of the
Matrix ecosystem to communicate with one another.</p>
<p>The principles that Matrix attempts to follow are:</p>
<ul class="simple">
<li>Pragmatic Web-friendly APIs (i.e. JSON over REST)</li>
<li>Keep It Simple &amp; Stupid<ul>
<li>provide a simple architecture with minimal third-party dependencies.</li>
</ul>
</li>
<li>Fully open:<ul>
<li>Fully open federation - anyone should be able to participate in the global
Matrix network</li>
<li>Fully open standard - publicly documented standard with no IP or patent
licensing encumbrances</li>
<li>Fully open source reference implementation - liberally-licensed example
implementations with no IP or patent licensing encumbrances</li>
</ul>
</li>
<li>Empowering the end-user<ul>
<li>The user should be able to choose the server and clients they use</li>
<li>The user should be able to control how private their communication is</li>
<li>The user should know precisely where their data is stored</li>
</ul>
</li>
<li>Fully decentralised - no single points of control over conversations or the
network as a whole</li>
<li>Learning from history to avoid repeating it<ul>
<li>Trying to take the best aspects of XMPP, SIP, IRC, SMTP, IMAP and NNTP
whilst trying to avoid their failings</li>
</ul>
</li>
</ul>
<p>The functionality that Matrix provides includes:</p>
<ul class="simple">
<li>Creation and management of fully distributed chat rooms with no
single points of control or failure</li>
<li>Eventually-consistent cryptographically secure synchronisation of room
state across a global open network of federated servers and services</li>
<li>Sending and receiving extensible messages in a room with (optional)
end-to-end encryption</li>
<li>Extensible user management (inviting, joining, leaving, kicking, banning)
mediated by a power-level based user privilege system.</li>
<li>Extensible room state management (room naming, aliasing, topics, bans)</li>
<li>Extensible user profile management (avatars, display names, etc)</li>
<li>Managing user accounts (registration, login, logout)</li>
<li>Use of 3rd Party IDs (3PIDs) such as email addresses, phone numbers,
Facebook accounts to authenticate, identify and discover users on Matrix.</li>
<li>Trusted federation of identity servers for:<ul>
<li>Publishing user public keys for PKI</li>
<li>Mapping of 3PIDs to Matrix IDs</li>
</ul>
</li>
</ul>
<p>The end goal of Matrix is to be a ubiquitous messaging layer for synchronising
arbitrary data between sets of people, devices and services - be that for
instant messages, VoIP call setups, or any other objects that need to be
reliably and persistently pushed from A to B in an interoperable and federated
manner.</p>
<p><a class="anchor" id="spec-change-proposals"></a></p>
<div class="section" id="spec-change-proposals">
<h2><a class="toc-backref" href="#id9">2.1&nbsp;&nbsp;&nbsp;Spec Change Proposals</a></h2>
<p>To propose a change to the Matrix Spec, see the explanations at <a class="reference external" href="proposals">Proposals
for Spec Changes to Matrix</a>.</p>
</div>
</div>
<p><a class="anchor" id="id2"></a></p>
<div class="section" id="id2">
<span id="architecture"></span><h1><a class="toc-backref" href="#id10">3&nbsp;&nbsp;&nbsp;Architecture</a></h1>
<p>Matrix defines APIs for synchronising extensible JSON objects known as
&quot;events&quot; between compatible clients, servers and services. Clients are
typically messaging/VoIP applications or IoT devices/hubs and communicate by
synchronising communication history with their &quot;homeserver&quot; using the
&quot;Client-Server API&quot;. Each homeserver stores the communication history and
account information for all of its clients, and shares data with the wider
Matrix ecosystem by synchronising communication history with other homeservers
and their clients.</p>
<p>Clients typically communicate with each other by emitting events in the
context of a virtual &quot;room&quot;. Room data is replicated across <em>all of the
homeservers</em> whose users are participating in a given room. As such, <em>no
single homeserver has control or ownership over a given room</em>. Homeservers
model communication history as a partially ordered graph of events known as
the room's &quot;event graph&quot;, which is synchronised with eventual consistency
between the participating servers using the &quot;Server-Server API&quot;. This process
of synchronising shared conversation history between homeservers run by
different parties is called &quot;Federation&quot;. Matrix optimises for the
Availability and Partitioned properties of CAP theorem at
the expense of Consistency.</p>
<p>For example, for client A to send a message to client B, client A performs an
HTTP PUT of the required JSON event on its homeserver (HS) using the
client-server API. A's HS appends this event to its copy of the room's event
graph, signing the message in the context of the graph for integrity. A's HS
then replicates the message to B's HS by performing an HTTP PUT using the
server-server API. B's HS authenticates the request, validates the event's
signature, authorises the event's contents and then adds it to its copy of the
room's event graph. Client B then receives the message from his homeserver via
a long-lived GET request.</p>
<pre class="literal-block">
                  How data flows between clients
                  ==============================

{ Matrix client A }                             { Matrix client B }
    ^          |                                    ^          |
    |  events  |  Client-Server API                 |  events  |
    |          V                                    |          V
+------------------+                            +------------------+
|                  |---------( HTTPS )---------&gt;|                  |
|   homeserver     |                            |   homeserver     |
|                  |&lt;--------( HTTPS )----------|                  |
+------------------+      Server-Server API     +------------------+
                       History Synchronisation
                           (Federation)
</pre>
<p><a class="anchor" id="users"></a></p>
<div class="section" id="users">
<h2><a class="toc-backref" href="#id11">3.1&nbsp;&nbsp;&nbsp;Users</a></h2>
<p>Each client is associated with a user account, which is identified in Matrix
using a unique &quot;user ID&quot;. This ID is namespaced to the homeserver which
allocated the account and has the form:</p>
<pre class="literal-block">
&#64;localpart:domain
</pre>
<p>See <a class="reference external" href="appendices.html#identifier-grammar">'Identifier Grammar' in the appendices</a> for full details of
the structure of user IDs.</p>
</div>
<p><a class="anchor" id="devices"></a></p>
<div class="section" id="devices">
<h2><a class="toc-backref" href="#id12">3.2&nbsp;&nbsp;&nbsp;Devices</a></h2>
<p>The Matrix specification has a particular meaning for the term &quot;device&quot;. As a
user, I might have several devices: a desktop client, some web browsers, an
Android device, an iPhone, etc. They broadly relate to a real device in the
physical world, but you might have several browsers on a physical device, or
several Matrix client applications on a mobile device, each of which would be
its own device.</p>
<p>Devices are used primarily to manage the keys used for end-to-end encryption
(each device gets its own copy of the decryption keys), but they also help
users manage their access - for instance, by revoking access to particular
devices.</p>
<p>When a user first uses a client, it registers itself as a new device. The
longevity of devices might depend on the type of client. A web client will
probably drop all of its state on logout, and create a new device every time
you log in, to ensure that cryptography keys are not leaked to a new user.  In
a mobile client, it might be acceptable to reuse the device if a login session
expires, provided the user is the same.</p>
<p>Devices are identified by a <tt class="docutils literal">device_id</tt>, which is unique within the scope of
a given user.</p>
<p>A user may assign a human-readable display name to a device, to help them
manage their devices.</p>
</div>
<p><a class="anchor" id="events"></a></p>
<div class="section" id="events">
<h2><a class="toc-backref" href="#id13">3.3&nbsp;&nbsp;&nbsp;Events</a></h2>
<p>All data exchanged over Matrix is expressed as an &quot;event&quot;. Typically each client
action (e.g. sending a message) correlates with exactly one event. Each event
has a <tt class="docutils literal">type</tt> which is used to differentiate different kinds of data. <tt class="docutils literal">type</tt>
values MUST be uniquely globally namespaced following Java's <a class="reference external" href="https://en.wikipedia.org/wiki/Java_package#Package_naming_conventions">package naming
conventions</a>, e.g.
<tt class="docutils literal">com.example.myapp.event</tt>. The special top-level namespace <tt class="docutils literal">m.</tt> is reserved
for events defined in the Matrix specification - for instance <tt class="docutils literal">m.room.message</tt>
is the event type for instant messages. Events are usually sent in the context
of a &quot;Room&quot;.</p>
</div>
<p><a class="anchor" id="event-graphs"></a></p>
<div class="section" id="event-graphs">
<h2><a class="toc-backref" href="#id14">3.4&nbsp;&nbsp;&nbsp;Event Graphs</a></h2>
<p id="sect-event-graph">Events exchanged in the context of a room are stored in a directed acyclic graph
(DAG) called an &quot;event graph&quot;. The partial ordering of this graph gives the
chronological ordering of events within the room. Each event in the graph has a
list of zero or more &quot;parent&quot; events, which refer to any preceding events
which have no chronological successor from the perspective of the homeserver
which created the event.</p>
<p>Typically an event has a single parent: the most recent message in the room at
the point it was sent. However, homeservers may legitimately race with each
other when sending messages, resulting in a single event having multiple
successors. The next event added to the graph thus will have multiple parents.
Every event graph has a single root event with no parent.</p>
<p>To order and ease chronological comparison between the events within the graph,
homeservers maintain a <tt class="docutils literal">depth</tt> metadata field on each event. An event's
<tt class="docutils literal">depth</tt> is a positive integer that is strictly greater than the depths of any
of its parents. The root event should have a depth of 1. Thus if one event is
before another, then it must have a strictly smaller depth.</p>
</div>
<p><a class="anchor" id="room-structure"></a></p>
<div class="section" id="room-structure">
<h2><a class="toc-backref" href="#id15">3.5&nbsp;&nbsp;&nbsp;Room structure</a></h2>
<p>A room is a conceptual place where users can send and receive events. Events are
sent to a room, and all participants in that room with sufficient access will
receive the event. Rooms are uniquely identified internally via &quot;Room IDs&quot;,
which have the form:</p>
<pre class="literal-block">
!opaque_id:domain
</pre>
<p>There is exactly one room ID for each room. Whilst the room ID does contain a
domain, it is simply for globally namespacing room IDs. The room does NOT
reside on the domain specified.</p>
<p>See <a class="reference external" href="appendices.html#identifier-grammar">'Identifier Grammar' in the appendices</a> for full details of
the structure of a room ID.</p>
<p>The following conceptual diagram shows an
<tt class="docutils literal">m.room.message</tt> event being sent to the room <tt class="docutils literal">!qporfwt:matrix.org</tt>:</p>
<pre class="literal-block">
 { &#64;alice:matrix.org }                             { &#64;bob:example.org }
         |                                                 ^
         |                                                 |
[HTTP POST]                                  [HTTP GET]
Room ID: !qporfwt:matrix.org                 Room ID: !qporfwt:matrix.org
Event type: m.room.message                   Event type: m.room.message
Content: { JSON object }                     Content: { JSON object }
         |                                                 |
         V                                                 |
 +------------------+                          +------------------+
 |   homeserver     |                          |   homeserver     |
 |   matrix.org     |                          |   example.org    |
 +------------------+                          +------------------+
         |                                                 ^
         |         [HTTP PUT]                              |
         |         Room ID: !qporfwt:matrix.org            |
         |         Event type: m.room.message              |
         |         Content: { JSON object }                |
         `-------&gt; Pointer to the preceding message  ------`
                   PKI signature from matrix.org
                   Transaction-layer metadata
                   PKI Authorization header

               ....................................
              |           Shared Data              |
              | State:                             |
              |   Room ID: !qporfwt:matrix.org     |
              |   Servers: matrix.org, example.org |
              |   Members:                         |
              |    - &#64;alice:matrix.org             |
              |    - &#64;bob:example.org              |
              | Messages:                          |
              |   - &#64;alice:matrix.org              |
              |     Content: { JSON object }       |
              |....................................|
</pre>
<p>Federation maintains <em>shared data structures</em> per-room between multiple
homeservers. The data is split into <tt class="docutils literal">message events</tt> and <tt class="docutils literal">state events</tt>.</p>
<dl class="docutils">
<dt>Message events:</dt>
<dd>These describe transient 'once-off' activity in a room such as
instant messages, VoIP call setups, file transfers, etc. They generally
describe communication activity.</dd>
<dt>State events:</dt>
<dd>These describe updates to a given piece of persistent information
('state') related to a room, such as the room's name, topic, membership,
participating servers, etc. State is modelled as a lookup table of key/value
pairs per room, with each key being a tuple of <tt class="docutils literal">state_key</tt> and <tt class="docutils literal">event type</tt>.
Each state event updates the value of a given key.</dd>
</dl>
<p>The state of the room at a given point is calculated by considering all events
preceding and including a given event in the graph. Where events describe the
same state, a merge conflict algorithm is applied. The state resolution
algorithm is transitive and does not depend on server state, as it must
consistently select the same event irrespective of the server or the order the
events were received in. Events are signed by the originating server (the
signature includes the parent relations, type, depth and payload hash) and are
pushed over federation to the participating servers in a room, currently using
full mesh topology. Servers may also request backfill of events over federation
from the other servers participating in a room.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Events are not limited to the types defined in this specification. New or custom
event types can be created on a whim using the Java package naming convention.
For example, a <tt class="docutils literal">com.example.game.score</tt> event can be sent by clients and other
clients would receive it through Matrix, assuming the client has access to the
<tt class="docutils literal">com.example</tt> namespace.</p>
</div>
<p><a class="anchor" id="room-aliases"></a></p>
<div class="section" id="room-aliases">
<h3><a class="toc-backref" href="#id16">3.5.1&nbsp;&nbsp;&nbsp;Room Aliases</a></h3>
<p>Each room can also have multiple &quot;Room Aliases&quot;, which look like:</p>
<pre class="literal-block">
#room_alias:domain
</pre>
<p>See <a class="reference external" href="appendices.html#identifier-grammar">'Identifier Grammar' in the appendices</a> for full details of
the structure of a room alias.</p>
<p>A room alias &quot;points&quot; to a room ID and is the human-readable label by which
rooms are publicised and discovered.  The room ID the alias is pointing to can
be obtained by visiting the domain specified. Note that the mapping from a room
alias to a room ID is not fixed, and may change over time to point to a
different room ID. For this reason, Clients SHOULD resolve the room alias to a
room ID once and then use that ID on subsequent requests.</p>
<p>When resolving a room alias the server will also respond with a list of servers
that are in the room that can be used to join via.</p>
<pre class="literal-block">
     HTTP GET
#matrix:example.org      !aaabaa:matrix.org
        |                    ^
        |                    |
 _______V____________________|____
|          example.org           |
| Mappings:                      |
| #matrix &gt;&gt; !aaabaa:matrix.org  |
| #golf   &gt;&gt; !wfeiofh:sport.com  |
| #bike   &gt;&gt; !4rguxf:matrix.org  |
|________________________________|
</pre>
</div>
</div>
<p><a class="anchor" id="identity"></a></p>
<div class="section" id="identity">
<h2><a class="toc-backref" href="#id17">3.6&nbsp;&nbsp;&nbsp;Identity</a></h2>
<p>Users in Matrix are identified via their Matrix user ID. However,
existing 3rd party ID namespaces can also be used in order to identify Matrix
users. A Matrix &quot;Identity&quot; describes both the user ID and any other existing IDs
from third party namespaces <em>linked</em> to their account.
Matrix users can <em>link</em> third-party IDs (3PIDs) such as email addresses, social
network accounts and phone numbers to their user ID. Linking 3PIDs creates a
mapping from a 3PID to a user ID. This mapping can then be used by Matrix
users in order to discover the user IDs of their contacts.
In order to ensure that the mapping from 3PID to user ID is genuine, a globally
federated cluster of trusted &quot;identity servers&quot; (IS) are used to verify the 3PID
and persist and replicate the mappings.</p>
<p>Usage of an IS is not required in order for a client application to be part of
the Matrix ecosystem. However, without one clients will not be able to look up
user IDs using 3PIDs.</p>
</div>
<p><a class="anchor" id="profiles"></a></p>
<div class="section" id="profiles">
<h2><a class="toc-backref" href="#id18">3.7&nbsp;&nbsp;&nbsp;Profiles</a></h2>
<p>Users may publish arbitrary key/value data associated with their account - such
as a human readable display name, a profile photo URL, contact information
(email address, phone numbers, website URLs etc).</p>
<!-- TODO
Actually specify the different types of data - e.g. what format are display
names allowed to be? -->
</div>
<p><a class="anchor" id="private-user-data"></a></p>
<div class="section" id="private-user-data">
<h2><a class="toc-backref" href="#id19">3.8&nbsp;&nbsp;&nbsp;Private User Data</a></h2>
<p>Users may also store arbitrary private key/value data in their account - such as
client preferences, or server configuration settings which lack any other
dedicated API.  The API is symmetrical to managing Profile data.</p>
<!-- TODO
Would it really be overengineered to use the same API for both profile &
private user data, but with different ACLs? -->
</div>
</div>
<p><a class="anchor" id="common-concepts"></a></p>
<div class="section" id="common-concepts">
<h1><a class="toc-backref" href="#id20">4&nbsp;&nbsp;&nbsp;Common concepts</a></h1>
<p>Various things are common throughout all of the Matrix APIs. They are
documented here.</p>
<!-- TODO: Some words about trailing slashes. See https://github.com/matrix-org/matrix-doc/issues/2107 -->
<p><a class="anchor" id="namespacing"></a></p>
<div class="section" id="namespacing">
<h2><a class="toc-backref" href="#id21">4.1&nbsp;&nbsp;&nbsp;Namespacing</a></h2>
<p>Namespacing helps prevent conflicts between multiple applications and the specification
itself. Where namespacing is used, <tt class="docutils literal">m.</tt> prefixes are used by the specification to
indicate that the field is controlled by the specification. Custom or non-specified
namespaces used in the wild MUST use the Java package naming convention to prevent
conflicts.</p>
<p>As an example, event types defined in the specification are namespaced under the
special <tt class="docutils literal">m.</tt> prefix, however any client can send a custom event type, such as
<tt class="docutils literal">com.example.game.score</tt> (assuming the client has rights to the <tt class="docutils literal">com.example</tt>
namespace) without needing to put the event into the <tt class="docutils literal">m.</tt> namespace.</p>
</div>
<p><a class="anchor" id="timestamps"></a></p>
<div class="section" id="timestamps">
<h2><a class="toc-backref" href="#id22">4.2&nbsp;&nbsp;&nbsp;Timestamps</a></h2>
<p>Unless otherwise stated, timestamps are measured as milliseconds since the Unix epoch.
Throughout the specification this may be referred to as POSIX, Unix, or just &quot;time in
milliseconds&quot;.</p>
</div>
</div>
<p><a class="anchor" id="id5"></a></p>
<div class="section" id="id5">
<span id="room-versions"></span><h1><a class="toc-backref" href="#id23">5&nbsp;&nbsp;&nbsp;Room Versions</a></h1>
<p>Rooms are central to how Matrix operates, and have strict rules for what
is allowed to be contained within them. Rooms can also have various
algorithms that handle different tasks, such as what to do when two or
more events collide in the underlying DAG. To allow rooms to be improved
upon through new algorithms or rules, &quot;room versions&quot; are employed to
manage a set of expectations for each room. New room versions are assigned
as needed.</p>
<p>There is no implicit ordering or hierarchy to room versions, and their principles
are immutable once placed in the specification. Although there is a recommended
set of versions, some rooms may benefit from features introduced by other versions.
Rooms move between different versions by &quot;upgrading&quot; to the desired version. Due
to versions not being ordered or hierarchical, this means a room can &quot;upgrade&quot;
from version 2 to version 1, if it is so desired.</p>
<p><a class="anchor" id="room-version-grammar"></a></p>
<div class="section" id="room-version-grammar">
<h2><a class="toc-backref" href="#id24">5.1&nbsp;&nbsp;&nbsp;Room version grammar</a></h2>
<p>Room versions are used to change properties of rooms that may not be compatible
with other servers. For example, changing the rules for event authorization would
cause older servers to potentially end up in a split-brain situation due to not
understanding the new rules.</p>
<p>A room version is defined as a string of characters which MUST NOT exceed 32
codepoints in length. Room versions MUST NOT be empty and SHOULD contain only
the characters <tt class="docutils literal"><span class="pre">a-z</span></tt>, <tt class="docutils literal"><span class="pre">0-9</span></tt>, <tt class="docutils literal">.</tt>, and <tt class="docutils literal">-</tt>.</p>
<p>Room versions are not intended to be parsed and should be treated as opaque
identifiers. Room versions consisting only of the characters <tt class="docutils literal"><span class="pre">0-9</span></tt> and <tt class="docutils literal">.</tt>
are reserved for future versions of the Matrix protocol.</p>
<p>The complete grammar for a legal room version is:</p>
<pre class="literal-block">
room_version = 1*room_version_char
room_version_char = DIGIT
                  / %x61-7A         ; a-z
                  / &quot;-&quot; / &quot;.&quot;
</pre>
<p>Examples of valid room versions are:</p>
<ul class="simple">
<li><tt class="docutils literal">1</tt> (would be reserved by the Matrix protocol)</li>
<li><tt class="docutils literal">1.2</tt> (would be reserved by the Matrix protocol)</li>
<li><tt class="docutils literal"><span class="pre">1.2-beta</span></tt></li>
<li><tt class="docutils literal">com.example.version</tt></li>
</ul>
</div>
<p><a class="anchor" id="complete-list-of-room-versions"></a></p>
<div class="section" id="complete-list-of-room-versions">
<h2><a class="toc-backref" href="#id25">5.2&nbsp;&nbsp;&nbsp;Complete list of room versions</a></h2>
<p>Room versions are divided into two distinct groups: stable and unstable. Stable
room versions may be used by rooms safely. Unstable room versions are everything
else which is either not listed in the specification or flagged as unstable for
some other reason. Versions can switch between stable and unstable periodically
for a variety of reasons, including discovered security vulnerabilities and age.</p>
<p>Clients should not ask room administrators to upgrade their rooms if the room is
running a stable version. Servers SHOULD use room version 6 as the default room
version when creating new rooms.</p>
<p>The available room versions are:</p>
<ul class="simple">
<li><a class="reference external" href="rooms/v1.html">Version 1</a> - <strong>Stable</strong>. The current version of most rooms.</li>
<li><a class="reference external" href="rooms/v2.html">Version 2</a> - <strong>Stable</strong>. Implements State Resolution Version 2.</li>
<li><a class="reference external" href="rooms/v3.html">Version 3</a> - <strong>Stable</strong>. Introduces events whose IDs are the event's hash.</li>
<li><a class="reference external" href="rooms/v4.html">Version 4</a> - <strong>Stable</strong>. Builds on v3 by using URL-safe base64 for event IDs.</li>
<li><a class="reference external" href="rooms/v5.html">Version 5</a> - <strong>Stable</strong>. Introduces enforcement of signing key validity periods.</li>
<li><a class="reference external" href="rooms/v6.html">Version 6</a> - <strong>Stable</strong>. Alters several authorization rules for events.</li>
</ul>
</div>
</div>
<p><a class="anchor" id="specification-versions"></a></p>
<div class="section" id="specification-versions">
<h1><a class="toc-backref" href="#id26">6&nbsp;&nbsp;&nbsp;Specification Versions</a></h1>
<dl class="docutils">
<dt>The specification for each API is versioned in the form <tt class="docutils literal">rX.Y.Z</tt>.</dt>
<dd><ul class="first last simple">
<li>A change to <tt class="docutils literal">X</tt> reflects a breaking change: a client implemented against
<tt class="docutils literal">r1.0.0</tt> may need changes to work with a server which supports (only)
<tt class="docutils literal">r2.0.0</tt>.</li>
<li>A change to <tt class="docutils literal">Y</tt> represents a change which is backwards-compatible for
existing clients, but not necessarily existing servers: a client implemented
against <tt class="docutils literal">r1.1.0</tt> will work without changes against a server which supports
<tt class="docutils literal">r1.2.0</tt>; but a client which requires <tt class="docutils literal">r1.2.0</tt> may not work correctly
with a server which implements only <tt class="docutils literal">r1.1.0</tt>.</li>
<li>A change to <tt class="docutils literal">Z</tt> represents a change which is backwards-compatible on both
sides. Typically this implies a clarification to the specification, rather
than a change which must be implemented.</li>
</ul>
</dd>
</dl>
</div>
<p><a class="anchor" id="license"></a></p>
<div class="section" id="license">
<h1><a class="toc-backref" href="#id27">7&nbsp;&nbsp;&nbsp;License</a></h1>
<p>The Matrix specification is licensed under the <a class="reference external" href="http://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a>.</p>
</div>
</div>
</body>
</html>
