<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.14: http://docutils.sourceforge.net/" />
<title>Application Service API</title>
%outdatedspecwarning%
<style type="text/css">

/*
 * basic.css
 * ~~~~~~~~~
 *
 * Sphinx stylesheet -- basic theme.
 *
 * :copyright: Copyright 2007-2010 by the Sphinx team, see AUTHORS.
 * :license: BSD, see LICENSE for details.
 *
 */

/* -- main layout ----------------------------------------------------------- */

div.clearer {
    clear: both;
}

/* -- relbar ---------------------------------------------------------------- */

div.related {
    width: 100%;
    font-size: 90%;
}

div.related h3 {
    display: none;
}

div.related ul {
    margin: 0;
    padding: 0 0 0 10px;
    list-style: none;
}

div.related li {
    display: inline;
}

div.related li.right {
    float: right;
    margin-right: 5px;
}

/* -- sidebar --------------------------------------------------------------- */

div.sphinxsidebarwrapper {
    padding: 10px 5px 0 10px;
}

div.sphinxsidebar {
    float: left;
    width: 230px;
    margin-left: -100%;
    font-size: 90%;
}

div.sphinxsidebar ul {
    list-style: none;
}

div.sphinxsidebar ul ul,
div.sphinxsidebar ul.want-points {
    margin-left: 20px;
    list-style: square;
}

div.sphinxsidebar ul ul {
    margin-top: 0;
    margin-bottom: 0;
}

div.sphinxsidebar form {
    margin-top: 10px;
}

div.sphinxsidebar input {
    border: 1px solid #98dbcc;
    font-family: sans-serif;
    font-size: 1em;
}

img {
    border: 0;
}

/* -- search page ----------------------------------------------------------- */

ul.search {
    margin: 10px 0 0 20px;
    padding: 0;
}

ul.search li {
    padding: 5px 0 5px 20px;
    background-image: url(file.png);
    background-repeat: no-repeat;
    background-position: 0 7px;
}

ul.search li a {
    font-weight: bold;
}

ul.search li div.context {
    color: #888;
    margin: 2px 0 0 30px;
    text-align: left;
}

ul.keywordmatches li.goodmatch a {
    font-weight: bold;
}

/* -- index page ------------------------------------------------------------ */

table.contentstable {
    width: 90%;
}

table.contentstable p.biglink {
    line-height: 150%;
}

a.biglink {
    font-size: 1.3em;
}

span.linkdescr {
    font-style: italic;
    padding-top: 5px;
    font-size: 90%;
}

/* -- general index --------------------------------------------------------- */

table.indextable {
    width: 100%;
}

table.indextable td {
    text-align: left;
    vertical-align: top;
}

table.indextable dl, table.indextable dd {
    margin-top: 0;
    margin-bottom: 0;
}

table.indextable tr.pcap {
    height: 10px;
}

table.indextable tr.cap {
    margin-top: 10px;
    background-color: #f2f2f2;
}

img.toggler {
    margin-right: 3px;
    margin-top: 3px;
    cursor: pointer;
}

div.modindex-jumpbox {
    border-top: 1px solid #ddd;
    border-bottom: 1px solid #ddd;
    margin: 1em 0 1em 0;
    padding: 0.4em;
}

div.genindex-jumpbox {
    border-top: 1px solid #ddd;
    border-bottom: 1px solid #ddd;
    margin: 1em 0 1em 0;
    padding: 0.4em;
}

/* -- general body styles --------------------------------------------------- */

a.headerlink {
    visibility: hidden;
}

h1:hover > a.headerlink,
h2:hover > a.headerlink,
h3:hover > a.headerlink,
h4:hover > a.headerlink,
h5:hover > a.headerlink,
h6:hover > a.headerlink,
dt:hover > a.headerlink {
    visibility: visible;
}

div.document p.caption {
    text-align: inherit;
}

div.document td {
    text-align: left;
}

.field-list ul {
    padding-left: 1em;
}

.first {
    margin-top: 0 !important;
}

p.rubric {
    margin-top: 30px;
    font-weight: bold;
}

.align-left {
    text-align: left;
}

.align-center {
    clear: both;
    text-align: center;
}

.align-right {
    text-align: right;
}

/* -- sidebars -------------------------------------------------------------- */

div.sidebar {
    margin: 0 0 0.5em 1em;
    border: 1px solid #ddb;
    padding: 7px 7px 0 7px;
    background-color: #ffe;
    width: 40%;
    float: right;
}

p.sidebar-title {
    font-weight: bold;
}

/* -- topics ---------------------------------------------------------------- */

div.topic {
    border: 1px solid #ccc;
    padding: 7px 7px 0 7px;
    margin: 10px 0 10px 0;
}

p.topic-title {
    font-size: 1.1em;
    font-weight: bold;
    margin-top: 10px;
}

/* -- admonitions ----------------------------------------------------------- */

div.admonition {
    margin-top: 10px;
    margin-bottom: 10px;
    padding: 7px;
}

div.admonition dt {
    font-weight: bold;
}

div.admonition dl {
    margin-bottom: 0;
}

p.admonition-title {
    margin: 0px 10px 5px 0px;
    font-weight: bold;
}

div.document p.centered {
    text-align: center;
    margin-top: 25px;
}

/* -- tables ---------------------------------------------------------------- */

table.docutils {
    border: 0;
    border-collapse: collapse;
}

table.docutils td, table.docutils th {
    padding: 1px 8px 1px 5px;
    border-top: 0;
    border-left: 0;
    border-right: 0;
    border-bottom: 1px solid #aaa;
}

table.field-list td, table.field-list th {
    border: 0 !important;
}

table.footnote td, table.footnote th {
    border: 0 !important;
}

th {
    text-align: left;
    padding-right: 5px;
}

table.citation {
    border-left: solid 1px gray;
    margin-left: 1px;
}

table.citation td {
    border-bottom: none;
}

table.colwidths-auto caption {
    font-family: 'Inconsolata', monospace;
    font-weight: 800;
    font-size: 120%;
    padding: 5px;
    text-align: left;
    margin-bottom: 2px;
}

.section ol, .section li {
    margin: 0px 0px 0px 30px !important;
}

p.httpheaders {
    font-weight: 800;
    font-size: 120%;
    padding: 5px;
    text-align: left;
    margin-bottom: 2px;
}

table.colwidths-auto {
    width:100%;
    margin-top: 20px;
}

table.colwidths-auto tr td:nth-child(1) {
    width: 15%;
}

table.colwidths-auto tr td:nth-child(2) {
    width: 15%;
    font-family: 'Inconsolata', monospace;
}

table.colwidths-auto tr td:nth-child(3) {
    width: 70%;
}


/* -- other body styles ----------------------------------------------------- */

ol.arabic {
    list-style: decimal;
}

ol.loweralpha {
    list-style: lower-alpha;
}

ol.upperalpha {
    list-style: upper-alpha;
}

ol.lowerroman {
    list-style: lower-roman;
}

ol.upperroman {
    list-style: upper-roman;
}

dl {
    margin-bottom: 15px;
}

dd p {
    margin-top: 0px;
}

dd ul, dd table {
    margin-bottom: 10px;
}

dd {
    margin-top: 3px;
    margin-bottom: 10px;
    margin-left: 30px;
}

dt:target, .highlighted {
    background-color: #fbe54e;
}

dl.glossary dt {
    font-weight: bold;
    font-size: 1.1em;
}

.field-list ul {
    margin: 0;
    padding-left: 1em;
}

.field-list p {
    margin: 0;
}

.refcount {
    color: #060;
}

.optional {
    font-size: 1.3em;
}

.versionmodified {
    font-style: italic;
}

.system-message {
    background-color: #fda;
    padding: 5px;
    border: 3px solid red;
}

.footnote:target  {
    background-color: #ffa
}

.line-block {
    display: block;
    margin-top: 1em;
    margin-bottom: 1em;
}

.line-block .line-block {
    margin-top: 0;
    margin-bottom: 0;
    margin-left: 1.5em;
}

.guilabel, .menuselection {
    font-family: sans-serif;
}

.accelerator {
    text-decoration: underline;
}

.classifier {
    font-style: oblique;
}

/* -- proposals page -------------------------------------------------------- */

#tables-of-tracked-proposals h2 {
    padding-left: 10px;
    position: -webkit-sticky;
    position: sticky;
}

/* Move sticky headers below header bar on desktop */
@media all and (min-width:980px) {
    #tables-of-tracked-proposals h2 {
        top: 52px;
    }
}

/* Sticky headers stick to the top on mobile */
@media all and (min-width:0px) and (max-width: 980px) {
    #tables-of-tracked-proposals h2 {
        top: 0px;
    }
}

/* -- code displays --------------------------------------------------------- */

pre {
    overflow: auto;
}

td.linenos pre {
    padding: 5px 0px;
    border: 0;
    background-color: transparent;
    color: #aaa;
}

table.highlighttable {
    margin-left: 0.5em;
}

table.highlighttable td {
    padding: 0 0.5em 0 0.5em;
}

tt.descname {
    background-color: transparent;
    font-weight: bold;
    font-size: 1.2em;
}

tt.descclassname {
    background-color: transparent;
}

tt.xref, a tt {
    background-color: transparent;
    font-weight: bold;
}

h1 tt, h2 tt, h3 tt, h4 tt, h5 tt, h6 tt {
    background-color: transparent;
}

.viewcode-link {
    float: right;
}

.viewcode-back {
    float: right;
    font-family: sans-serif;
}

div.viewcode-block:target {
    margin: -1px -10px;
    padding: 0 10px;
}

/* -- math display ---------------------------------------------------------- */

img.math {
    vertical-align: middle;
}

div.document div.math p {
    text-align: center;
}

span.eqno {
    float: right;
}

/* -- printout stylesheet --------------------------------------------------- */

@media print {
    div.document,
    div.documentwrapper,
    div.bodywrapper {
        margin: 0 !important;
        width: 100%;
    }

    div.sphinxsidebar,
    div.related,
    div.footer,
    #top-link {
        display: none;
    }
}


</style>
<style type="text/css">

blockquote {
    margin: 20px 0 30px;
    padding-left: 20px;
}

</style>
<style type="text/css">

pre.code .comment, code .comment { color: green }
pre.code .keyword, code .keyword { color: darkred; font-weight: bold }
pre.code .name.builtin, code .name.builtin { color: darkred; font-weight: bold }
pre.code .name.tag, code .name.tag { color: darkgreen }
pre.code .literal, code .literal { color: darkblue }
pre.code .literal.number, code .literal.number { color: blue }


/* HTTP Methods have class "name function" */
pre.code.http .name.function,  code.http .name.function { color: black; font-weight: bold }
/* HTTP Paths have class "name namespace" */
pre.code.http .name.namespace, code.http .name.namespace { color: darkgreen }
/* HTTP "HTTP" strings have class "keyword reserved" */
pre.code.http .keyword.reserved, code.http .keyword.reserved { color: black; font-weight: bold }
/* HTTP Header names have class "name attribute" */
pre.code.http .name.attribute, code.http .name.attribute { color: black; font-weight: bold }

</style>
<style type="text/css">

/*
 * nature.css_t
 * ~~~~~~~~~~~~
 *
 * Sphinx stylesheet -- nature theme.
 *
 * :copyright: Copyright 2007-2010 by the Sphinx team, see AUTHORS.
 * :license: BSD, see LICENSE for details.
 *
 */

/* -- page layout ----------------------------------------------------------- */

body {
    font-family: Arial, sans-serif;
    font-size: 100%;
    /*background-color: #111;*/
    color: #555;
    margin: 0;
    padding: 0;
}

div.documentwrapper {
    float: left;
    width: 100%;
}

div.bodywrapper {
    margin: 0 0 0 230px;
}

hr {
    border: 1px solid #B1B4B6;
}

/*
div.document {
    background-color: #eee;
}
*/

div.document {
    background-color: #ffffff;
    color: #3E4349;
    padding: 0 30px 30px 30px;
    font-size: 0.9em;
}

div.footer {
    color: #555;
    width: 100%;
    padding: 13px 0;
    text-align: center;
    font-size: 75%;
}

div.footer a {
    color: #444;
    text-decoration: underline;
}

div.related {
    background-color: #6BA81E;
    line-height: 32px;
    color: #fff;
    text-shadow: 0px 1px 0 #444;
    font-size: 0.9em;
}

div.related a {
    color: #E2F3CC;
}

div.sphinxsidebar {
    font-size: 0.75em;
    line-height: 1.5em;
}

div.sphinxsidebarwrapper{
    padding: 20px 0;
}

div.sphinxsidebar h3,
div.sphinxsidebar h4 {
    font-family: Arial, sans-serif;
    color: #222;
    font-size: 1.2em;
    font-weight: normal;
    margin: 0;
    padding: 5px 10px;
    background-color: #ddd;
    text-shadow: 1px 1px 0 white
}

div.sphinxsidebar h4{
    font-size: 1.1em;
}

div.sphinxsidebar h3 a {
    color: #444;
}


div.sphinxsidebar p {
    color: #888;
    padding: 5px 20px;
}

div.sphinxsidebar p.topless {
}

div.sphinxsidebar ul {
    margin: 10px 20px;
    padding: 0;
    color: #000;
}

div.sphinxsidebar a {
    color: #444;
}

div.sphinxsidebar input {
    border: 1px solid #ccc;
    font-family: sans-serif;
    font-size: 1em;
}

div.sphinxsidebar input[type=text]{
    margin-left: 20px;
}

/* -- body styles ----------------------------------------------------------- */

a {
    color: #005B81;
    text-decoration: none;
}

a:hover {
    color: #E32E00;
    text-decoration: underline;
}

div.document h1,
div.document h2,
div.document h3,
div.document h4,
div.document h5,
div.document h6 {
    font-family: Arial, sans-serif;
    background-color: #BED4EB;
    font-weight: normal;
    color: #212224;
    margin: 30px 0px 10px 0px;
    padding: 5px 0 5px 10px;
    text-shadow: 0px 1px 0 white
}

div.document h1 { border-top: 20px solid white; margin-top: 0; font-size: 200%; }
div.document h2 { font-size: 150%; background-color: #C8D5E3; }
div.document h3 { font-size: 120%; background-color: #D8DEE3; }
div.document h4 { font-size: 110%; background-color: #D8DEE3; }
div.document h5 { font-size: 100%; background-color: #D8DEE3; }
div.document h6 { font-size: 100%; background-color: #D8DEE3; }

a.headerlink {
    color: #c60f0f;
    font-size: 0.8em;
    padding: 0 4px 0 4px;
    text-decoration: none;
}

a.headerlink:hover {
    background-color: #c60f0f;
    color: white;
}

div.document p, div.document dd, div.document li {
    line-height: 1.5em;
}

div.admonition p.admonition-title + p {
    display: inline;
}

div.highlight{
    background-color: white;
}

div.note {
    background-color: #eee;
    border: 1px solid #ccc;
}

div.seealso {
    background-color: #ffc;
    border: 1px solid #ff6;
}

div.topic {
    background-color: #eee;
}

div.warning {
    background-color: #ffe4e4;
    border: 1px solid #f66;
}

p.admonition-title {
    display: inline;
}

p.admonition-title:after {
    content: ":";
}

pre {
    padding: 10px;
    background-color: White;
    color: #222;
    line-height: 1.2em;
    border: 1px solid #C6C9CB;
    font-size: 1.1em;
    margin: 1.5em 0 1.5em 0;
    -webkit-box-shadow: 1px 1px 1px #d8d8d8;
    -moz-box-shadow: 1px 1px 1px #d8d8d8;
}

tt {
    background-color: #ecf0f3;
    color: #222;
    /* padding: 1px 2px; */
    font-size: 1.1em;
    font-family: monospace;
}

.viewcode-back {
    font-family: Arial, sans-serif;
}

div.viewcode-block:target {
    background-color: #f4debf;
    border-top: 1px solid #ac9;
    border-bottom: 1px solid #ac9;
}

ul li dd {
	margin-top: 0;
}

ul li dl {
	margin-bottom: 0;
}

li dl dd {
	margin-bottom: 0;
}

dd ul {
	padding-left: 0;
}

li dd ul {
	margin-bottom: 0;
}

table {
    margin-top: 10px;
    margin-bottom: 10px;
    border: 0;
    border-collapse: collapse;
}

td[colspan]:not([colspan="1"]) {
    background: #eeeeee;
    text-transform: capitalize;
}

thead {
    background: #eeeeee;
}

div.admonition-rationale {
    background-color: #efe;
    border: 1px solid #ccc;
}

div.admonition-example {
    background-color: #eef;
    border: 1px solid #ccc;
}


</style>
<style type="text/css">

/* Column with header cells */
table.docutils tbody th.stub {
    background: #eeeeee;
}

</style>
</head>
<body>
<div class="document" id="application-service-api">
<h1 class="title">Application Service API</h1>

<!-- Copyright 2016 OpenMarket Ltd -->
<!-- Copyright 2018 New Vector Ltd -->
<!--  -->
<!-- Licensed under the Apache License, Version 2.0 (the "License"); -->
<!-- you may not use this file except in compliance with the License. -->
<!-- You may obtain a copy of the License at -->
<!--  -->
<!-- http://www.apache.org/licenses/LICENSE-2.0 -->
<!--  -->
<!-- Unless required by applicable law or agreed to in writing, software -->
<!-- distributed under the License is distributed on an "AS IS" BASIS, -->
<!-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. -->
<!-- See the License for the specific language governing permissions and -->
<!-- limitations under the License. -->
<p>The Matrix client-server API and server-server APIs provide the means to
implement a consistent self-contained federated messaging fabric. However, they
provide limited means of implementing custom server-side behaviour in Matrix
(e.g. gateways, filters, extensible hooks etc). The Application Service API (AS API)
defines a standard API to allow such extensible functionality to be implemented
irrespective of the underlying homeserver implementation.</p>
<!-- TODO-spec
Add in Client-Server services? Overview of bots? Seems weird to be in the spec
given it is VERY implementation specific. -->
<div class="contents topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="auto-toc simple">
<li><a class="reference internal" href="#changelog" id="id3">1&nbsp;&nbsp;&nbsp;Changelog</a><ul class="auto-toc">
<li><a class="reference internal" href="#other-versions-of-this-specification" id="id4">1.1&nbsp;&nbsp;&nbsp;Other versions of this specification</a></li>
</ul>
</li>
<li><a class="reference internal" href="#application-services" id="id5">2&nbsp;&nbsp;&nbsp;Application Services</a><ul class="auto-toc">
<li><a class="reference internal" href="#registration" id="id6">2.1&nbsp;&nbsp;&nbsp;Registration</a></li>
<li><a class="reference internal" href="#homeserver-application-service-api" id="id7">2.2&nbsp;&nbsp;&nbsp;Homeserver -&gt; Application Service API</a><ul class="auto-toc">
<li><a class="reference internal" href="#authorization" id="id8">2.2.1&nbsp;&nbsp;&nbsp;Authorization</a></li>
<li><a class="reference internal" href="#legacy-routes" id="id9">2.2.2&nbsp;&nbsp;&nbsp;Legacy routes</a></li>
<li><a class="reference internal" href="#pushing-events" id="id10">2.2.3&nbsp;&nbsp;&nbsp;Pushing events</a><ul class="auto-toc">
<li><a class="reference internal" href="#put-matrix-app-v1-transactions-txnid" id="id11">2.2.3.1&nbsp;&nbsp;&nbsp;<tt class="docutils literal">PUT <span class="pre">/_matrix/app/v1/transactions/{txnId}</span></tt></a></li>
</ul>
</li>
<li><a class="reference internal" href="#querying" id="id12">2.2.4&nbsp;&nbsp;&nbsp;Querying</a><ul class="auto-toc">
<li><a class="reference internal" href="#get-matrix-app-v1-users-userid" id="id13">2.2.4.1&nbsp;&nbsp;&nbsp;<tt class="docutils literal">GET <span class="pre">/_matrix/app/v1/users/{userId}</span></tt></a></li>
<li><a class="reference internal" href="#get-matrix-app-v1-rooms-roomalias" id="id14">2.2.4.2&nbsp;&nbsp;&nbsp;<tt class="docutils literal">GET <span class="pre">/_matrix/app/v1/rooms/{roomAlias}</span></tt></a></li>
</ul>
</li>
<li><a class="reference internal" href="#third-party-networks" id="id15">2.2.5&nbsp;&nbsp;&nbsp;Third party networks</a><ul class="auto-toc">
<li><a class="reference internal" href="#get-matrix-app-v1-thirdparty-protocol-protocol" id="id16">2.2.5.1&nbsp;&nbsp;&nbsp;<tt class="docutils literal">GET <span class="pre">/_matrix/app/v1/thirdparty/protocol/{protocol}</span></tt></a></li>
<li><a class="reference internal" href="#get-matrix-app-v1-thirdparty-user-protocol" id="id17">2.2.5.2&nbsp;&nbsp;&nbsp;<tt class="docutils literal">GET <span class="pre">/_matrix/app/v1/thirdparty/user/{protocol}</span></tt></a></li>
<li><a class="reference internal" href="#get-matrix-app-v1-thirdparty-location-protocol" id="id18">2.2.5.3&nbsp;&nbsp;&nbsp;<tt class="docutils literal">GET <span class="pre">/_matrix/app/v1/thirdparty/location/{protocol}</span></tt></a></li>
<li><a class="reference internal" href="#get-matrix-app-v1-thirdparty-location" id="id19">2.2.5.4&nbsp;&nbsp;&nbsp;<tt class="docutils literal">GET /_matrix/app/v1/thirdparty/location</tt></a></li>
<li><a class="reference internal" href="#get-matrix-app-v1-thirdparty-user" id="id20">2.2.5.5&nbsp;&nbsp;&nbsp;<tt class="docutils literal">GET /_matrix/app/v1/thirdparty/user</tt></a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#client-server-api-extensions" id="id21">2.3&nbsp;&nbsp;&nbsp;Client-Server API Extensions</a><ul class="auto-toc">
<li><a class="reference internal" href="#identity-assertion" id="id22">2.3.1&nbsp;&nbsp;&nbsp;Identity assertion</a></li>
<li><a class="reference internal" href="#timestamp-massaging" id="id23">2.3.2&nbsp;&nbsp;&nbsp;Timestamp massaging</a></li>
<li><a class="reference internal" href="#server-admin-style-permissions" id="id24">2.3.3&nbsp;&nbsp;&nbsp;Server admin style permissions</a></li>
<li><a class="reference internal" href="#using-sync-and-events" id="id25">2.3.4&nbsp;&nbsp;&nbsp;Using <tt class="docutils literal">/sync</tt> and <tt class="docutils literal">/events</tt></a></li>
<li><a class="reference internal" href="#application-service-room-directories" id="id26">2.3.5&nbsp;&nbsp;&nbsp;Application service room directories</a><ul class="auto-toc">
<li><a class="reference internal" href="#put-matrix-client-r0-directory-list-appservice-networkid-roomid" id="id27">2.3.5.1&nbsp;&nbsp;&nbsp;<tt class="docutils literal">PUT <span class="pre">/_matrix/client/r0/directory/list/appservice/{networkId}/{roomId}</span></tt></a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#referencing-messages-from-a-third-party-network" id="id28">2.4&nbsp;&nbsp;&nbsp;Referencing messages from a third party network</a></li>
</ul>
</li>
</ul>
</div>
<p><a class="anchor" id="changelog"></a></p>
<div class="section" id="changelog">
<h1><a class="toc-backref" href="#id3">1&nbsp;&nbsp;&nbsp;Changelog</a></h1>
<div class="topic">
<p class="topic-title first">Version: r0.1.1</p>
<p>Spec Clarifications</p>
<ul class="simple">
<li>Change examples to use example.org instead of a real domain. (<a class="reference external" href="https://github.com/matrix-org/matrix-doc/issues/1650">#1650</a>)</li>
<li>Add missing definition for how appservices verify requests came from a homeserver. (<a class="reference external" href="https://github.com/matrix-org/matrix-doc/issues/2037">#2037</a>)</li>
</ul>
</div>
<p>This version of the specification is generated from
<a class="reference external" href="https://github.com/matrix-org/matrix-doc">matrix-doc</a> as of Git commit
<a class="reference external" href="https://github.com/matrix-org/matrix-doc/tree/98c9d93b">master,98c9d93b</a>.</p>
<p>For the full historical changelog, see
<a class="reference external" href="https://github.com/matrix-org/matrix-doc/blob/main/changelogs/legacy/application_service.rst">https://github.com/matrix-org/matrix-doc/blob/main/changelogs/legacy/application_service.rst</a></p>
<p><a class="anchor" id="other-versions-of-this-specification"></a></p>
<div class="section" id="other-versions-of-this-specification">
<h2><a class="toc-backref" href="#id4">1.1&nbsp;&nbsp;&nbsp;Other versions of this specification</a></h2>
<p>The following other versions are also available, in reverse chronological order:</p>
<ul class="simple">
<li><a class="reference external" href="https://matrix.org/docs/spec/application_service/unstable.html">HEAD</a>: Includes all changes since the latest versioned release.</li>
<li><a class="reference external" href="https://matrix.org/docs/spec/application_service/r0.1.1.html">r0.1.1</a></li>
<li><a class="reference external" href="https://matrix.org/docs/spec/application_service/r0.1.0.html">r0.1.0</a></li>
</ul>
</div>
</div>
<p><a class="anchor" id="application-services"></a></p>
<div class="section" id="application-services">
<h1><a class="toc-backref" href="#id5">2&nbsp;&nbsp;&nbsp;Application Services</a></h1>
<p>Application services are passive and can only observe events from homeserver.
They can inject events into rooms they are participating in.
They cannot prevent events from being sent, nor can they modify the content of
the event being sent. In order to observe events from a homeserver, the
homeserver needs to be configured to pass certain types of traffic to the
application service.  This is achieved by manually configuring the homeserver
with information about the application service.</p>
<p><a class="anchor" id="registration"></a></p>
<div class="section" id="registration">
<h2><a class="toc-backref" href="#id6">2.1&nbsp;&nbsp;&nbsp;Registration</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Previously, application services could register with a homeserver via HTTP
APIs. This was removed as it was seen as a security risk. A compromised
application service could re-register for a global <tt class="docutils literal">*</tt> regex and sniff
<em>all</em> traffic on the homeserver. To protect against this, application
services now have to register via configuration files which are linked to
the homeserver configuration file. The addition of configuration files
allows homeserver admins to sanity check the registration for suspicious
regex strings.</p>
</div>
<!-- TODO
Removing the API entirely is probably a mistake - having a standard cross-HS
way of doing this stops ASes being coupled to particular HS implementations.
A better solution would be to somehow mandate that the API done to avoid
abuse. -->
<p>Application services register &quot;namespaces&quot; of user IDs, room aliases and room IDs.
These namespaces are represented as regular expressions. An application service
is said to be &quot;interested&quot; in a given event if one of the IDs in the event match
the regular expression provided by the application service, such as the room having
an alias or ID in the relevant namespaces. Similarly, the application service is
said to be interested in a given event if one of the application service's namespaced
users is the target of the event, or is a joined member of the room where the event
occurred.</p>
<p>An application service can also state whether they should be the only ones who
can manage a specified namespace. This is referred to as an &quot;exclusive&quot;
namespace. An exclusive namespace prevents humans and other application
services from creating/deleting entities in that namespace. Typically,
exclusive namespaces are used when the rooms represent real rooms on
another service (e.g. IRC). Non-exclusive namespaces are used when the
application service is merely augmenting the room itself (e.g. providing
logging or searching facilities). Namespaces are represented by POSIX extended
regular expressions and look like:</p>
<pre class="code yaml literal-block">
<span class="name tag">users</span><span class="punctuation">:</span>
  <span class="punctuation indicator">-</span> <span class="name tag">exclusive</span><span class="punctuation">:</span> <span class="literal scalar plain">true</span>
    <span class="name tag">regex</span><span class="punctuation">:</span> <span class="literal string">&quot;&#64;_irc_bridge_.*&quot;</span>
</pre>
<p>Application services may define the following namespaces (with none being explicitly required):</p>
<table border="1" class="docutils">
<colgroup>
<col width="23%" />
<col width="77%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Name</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>users</td>
<td>Events which are sent from certain users.</td>
</tr>
<tr><td>aliases</td>
<td>Events which are sent in rooms with certain room aliases.</td>
</tr>
<tr><td>rooms</td>
<td>Events which are sent in rooms with certain room IDs.</td>
</tr>
</tbody>
</table>
<p>Each individual namespace MUST declare the following fields:</p>
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="88%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Name</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>exclusive</td>
<td><strong>Required</strong> A true or false value stating whether this application service has exclusive access to events within this namespace.</td>
</tr>
<tr><td>regex</td>
<td><strong>Required</strong> A regular expression defining which values this namespace includes.</td>
</tr>
</tbody>
</table>
<p>Exclusive user and alias namespaces should begin with an underscore after the
sigil to avoid collisions with other users on the homeserver. Application
services should additionally attempt to identify the service they represent
in the reserved namespace. For example, <tt class="docutils literal">&#64;_irc_.*</tt> would be a good namespace
to register for an application service which deals with IRC.</p>
<p>The registration is represented by a series of key-value pairs, which this
specification will present as YAML. See below for the possible options along
with their explanation:</p>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Name</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>id</td>
<td><strong>Required.</strong> A unique, user-defined ID of the application service which will never change.</td>
</tr>
<tr><td>url</td>
<td><strong>Required.</strong> The URL for the application service. May include a path after the domain name. Optionally set to <tt class="docutils literal">null</tt> if no traffic is required.</td>
</tr>
<tr><td>as_token</td>
<td><strong>Required.</strong> A unique token for application services to use to authenticate requests to Homeservers.</td>
</tr>
<tr><td>hs_token</td>
<td><strong>Required.</strong> A unique token for Homeservers to use to authenticate requests to application services.</td>
</tr>
<tr><td>sender_localpart</td>
<td><strong>Required.</strong> The localpart of the user associated with the application service.</td>
</tr>
<tr><td>namespaces</td>
<td><strong>Required.</strong> A list of <tt class="docutils literal">users</tt>, <tt class="docutils literal">aliases</tt> and <tt class="docutils literal">rooms</tt> namespaces that the application service controls.</td>
</tr>
<tr><td>rate_limited</td>
<td>Whether requests from masqueraded users are rate-limited. The sender is excluded.</td>
</tr>
<tr><td>protocols</td>
<td>The external protocols which the application service provides (e.g. IRC).</td>
</tr>
</tbody>
</table>
<p>An example registration file for an IRC-bridging application service is below:</p>
<pre class="code yaml literal-block">
<span class="name tag">id</span><span class="punctuation">:</span> <span class="literal string">&quot;IRC</span><span class="name variable"> </span><span class="literal string">Bridge&quot;</span>
<span class="name tag">url</span><span class="punctuation">:</span> <span class="literal string">&quot;http://127.0.0.1:1234&quot;</span>
<span class="name tag">as_token</span><span class="punctuation">:</span> <span class="literal string">&quot;30c05ae90a248a4188e620216fa72e349803310ec83e2a77b34fe90be6081f46&quot;</span>
<span class="name tag">hs_token</span><span class="punctuation">:</span> <span class="literal string">&quot;312df522183efd404ec1cd22d2ffa4bbc76a8c1ccf541dd692eef281356bb74e&quot;</span>
<span class="name tag">sender_localpart</span><span class="punctuation">:</span> <span class="literal string">&quot;_irc_bot&quot;</span> <span class="comment single"># Will result in &#64;_irc_bot:example.org</span>
<span class="name tag">namespaces</span><span class="punctuation">:</span>
  <span class="name tag">users</span><span class="punctuation">:</span>
    <span class="punctuation indicator">-</span> <span class="name tag">exclusive</span><span class="punctuation">:</span> <span class="literal scalar plain">true</span>
      <span class="name tag">regex</span><span class="punctuation">:</span> <span class="literal string">&quot;&#64;_irc_bridge_.*&quot;</span>
  <span class="name tag">aliases</span><span class="punctuation">:</span>
    <span class="punctuation indicator">-</span> <span class="name tag">exclusive</span><span class="punctuation">:</span> <span class="literal scalar plain">false</span>
      <span class="name tag">regex</span><span class="punctuation">:</span> <span class="literal string">&quot;#_irc_bridge_.*&quot;</span>
  <span class="name tag">rooms</span><span class="punctuation">:</span> <span class="punctuation indicator">[]</span>
</pre>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">If the homeserver in question has multiple application services, each
<tt class="docutils literal">as_token</tt> and <tt class="docutils literal">id</tt> MUST be unique per application service as these are
used to identify the application service. The homeserver MUST enforce this.</p>
</div>
</div>
<p><a class="anchor" id="homeserver-application-service-api"></a></p>
<div class="section" id="homeserver-application-service-api">
<h2><a class="toc-backref" href="#id7">2.2&nbsp;&nbsp;&nbsp;Homeserver -&gt; Application Service API</a></h2>
<p><a class="anchor" id="authorization"></a></p>
<div class="section" id="authorization">
<h3><a class="toc-backref" href="#id8">2.2.1&nbsp;&nbsp;&nbsp;Authorization</a></h3>
<p>Homeservers MUST include a query parameter named <tt class="docutils literal">access_token</tt> containing the
<tt class="docutils literal">hs_token</tt> from the application service's registration when making requests to
the application service. Application services MUST verify the provided <tt class="docutils literal">access_token</tt>
matches their known <tt class="docutils literal">hs_token</tt>, failing the request with a <tt class="docutils literal">M_FORBIDDEN</tt> error
if it does not match.</p>
</div>
<p><a class="anchor" id="legacy-routes"></a></p>
<div class="section" id="legacy-routes">
<h3><a class="toc-backref" href="#id9">2.2.2&nbsp;&nbsp;&nbsp;Legacy routes</a></h3>
<p>Previous drafts of the application service specification had a mix of endpoints
that have been used in the wild for a significant amount of time. The application
service specification now defines a version on all endpoints to be more compatible
with the rest of the Matrix specification and the future.</p>
<p>Homeservers should attempt to use the specified endpoints first when communicating
with application services. However, if the application service receives an http status
code that does not indicate success (ie: 404, 500, 501, etc) then the homeserver
should fall back to the older endpoints for the application service.</p>
<p>The older endpoints have the exact same request body and response format, they
just belong at a different path. The equivalent path for each is as follows:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">/_matrix/app/v1/transactions/{txnId}</span></tt> becomes <tt class="docutils literal"><span class="pre">/transactions/{txnId}</span></tt></li>
<li><tt class="docutils literal"><span class="pre">/_matrix/app/v1/users/{userId}</span></tt> becomes <tt class="docutils literal"><span class="pre">/users/{userId}</span></tt></li>
<li><tt class="docutils literal"><span class="pre">/_matrix/app/v1/rooms/{roomAlias}</span></tt> becomes <tt class="docutils literal"><span class="pre">/rooms/{roomAlias}</span></tt></li>
<li><tt class="docutils literal"><span class="pre">/_matrix/app/v1/thirdparty/protocol/{protocol}</span></tt> becomes <tt class="docutils literal"><span class="pre">/_matrix/app/unstable/thirdparty/protocol/{protocol}</span></tt></li>
<li><tt class="docutils literal"><span class="pre">/_matrix/app/v1/thirdparty/user/{user}</span></tt> becomes <tt class="docutils literal"><span class="pre">/_matrix/app/unstable/thirdparty/user/{user}</span></tt></li>
<li><tt class="docutils literal"><span class="pre">/_matrix/app/v1/thirdparty/location/{location}</span></tt> becomes <tt class="docutils literal"><span class="pre">/_matrix/app/unstable/thirdparty/location/{location}</span></tt></li>
<li><tt class="docutils literal">/_matrix/app/v1/thirdparty/user</tt> becomes <tt class="docutils literal">/_matrix/app/unstable/thirdparty/user</tt></li>
<li><tt class="docutils literal">/_matrix/app/v1/thirdparty/location</tt> becomes <tt class="docutils literal">/_matrix/app/unstable/thirdparty/location</tt></li>
</ul>
<p>Homeservers should periodically try again for the newer endpoints because the
application service may have been updated.</p>
</div>
<p><a class="anchor" id="pushing-events"></a></p>
<div class="section" id="pushing-events">
<h3><a class="toc-backref" href="#id10">2.2.3&nbsp;&nbsp;&nbsp;Pushing events</a></h3>
<p>The application service API provides a transaction API for sending a list of
events. Each list of events includes a transaction ID, which works as follows:</p>
<pre class="literal-block">
Typical
HS ---&gt; AS : Homeserver sends events with transaction ID T.
   &lt;---    : Application Service sends back 200 OK.

AS ACK Lost
HS ---&gt; AS : Homeserver sends events with transaction ID T.
   &lt;-/-    : AS 200 OK is lost.
HS ---&gt; AS : Homeserver retries with the same transaction ID of T.
   &lt;---    : Application Service sends back 200 OK. If the AS had processed these
             events already, it can NO-OP this request (and it knows if it is the
             same events based on the transaction ID).
</pre>
<p>The events sent to the application service should be linearised, as if they were
from the event stream. The homeserver MUST maintain a queue of transactions to
send to the application service. If the application service cannot be reached, the
homeserver SHOULD backoff exponentially until the application service is reachable again.
As application services cannot <em>modify</em> the events in any way, these requests can
be made without blocking other aspects of the homeserver. Homeservers MUST NOT
alter (e.g. add more) events they were going to send within that transaction ID
on retries, as the application service may have already processed the events.</p>
<p><a class="anchor" id="put-matrix-app-v1-transactions-txnid"></a></p>
<div class="section" id="put-matrix-app-v1-transactions-txnid">
<h4><a class="toc-backref" href="#id11">2.2.3.1&nbsp;&nbsp;&nbsp;<tt class="docutils literal">PUT <span class="pre">/_matrix/app/v1/transactions/{txnId}</span></tt></a></h4>
<p>This API is called by the homeserver when it wants to push an event
(or batch of events) to the application service.</p>
<p>Note that the application service should distinguish state events
from message events via the presence of a <tt class="docutils literal">state_key</tt>, rather than
via the event type.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Rate-limited:</th><td class="field-body">No.</td>
</tr>
<tr class="field"><th class="field-name">Requires auth:</th><td class="field-body">Yes.</td>
</tr>
</tbody>
</table>
<p class="httpheaders">Request format:</p>
<table border="1" class="colwidths-auto docutils">
<thead valign="bottom">
<tr><th class="head">Parameter</th>
<th class="head">Type</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr><td colspan="3"><em>path parameters</em></td>
</tr>
<tr><td>txnId</td>
<td>string</td>
<td><strong>Required.</strong> The transaction ID for this set of
events. Homeservers generate these IDs and they
are used to ensure idempotency of requests.</td>
</tr>
<tr><td colspan="3"><em>JSON body parameters</em></td>
</tr>
<tr><td>events</td>
<td>[Event]</td>
<td><strong>Required.</strong> A list of events, formatted as per
the Client-Server API.</td>
</tr>
</tbody>
</table>
<p class="httpheaders">Example request:</p>
<pre class="code http literal-block">
<span class="name function">PUT</span> <span class="name namespace">/_matrix/app/v1/transactions/35</span> <span class="keyword reserved">HTTP</span><span class="operator">/</span><span class="literal number">1.1</span>
<span class="name attribute">Content-Type</span><span class="operator">:</span> <span class="literal">application/json</span>

<span class="punctuation">{</span>
  <span class="name tag">&quot;events&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span>
    <span class="punctuation">{</span>
      <span class="name tag">&quot;content&quot;</span><span class="punctuation">:</span> <span class="punctuation">{</span>
        <span class="name tag">&quot;membership&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;join&quot;</span><span class="punctuation">,</span>
        <span class="name tag">&quot;avatar_url&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;mxc://example.org/SEsfnsuifSDFSSEF&quot;</span><span class="punctuation">,</span>
        <span class="name tag">&quot;displayname&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;Alice Margatroid&quot;</span>
      <span class="punctuation">},</span>
      <span class="name tag">&quot;type&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;m.room.member&quot;</span><span class="punctuation">,</span>
      <span class="name tag">&quot;event_id&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;$143273582443PhrSn:example.org&quot;</span><span class="punctuation">,</span>
      <span class="name tag">&quot;room_id&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;!jEsUZKDJdhlrceRyVU:example.org&quot;</span><span class="punctuation">,</span>
      <span class="name tag">&quot;sender&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;&#64;example:example.org&quot;</span><span class="punctuation">,</span>
      <span class="name tag">&quot;origin_server_ts&quot;</span><span class="punctuation">:</span> <span class="literal number integer">1432735824653</span><span class="punctuation">,</span>
      <span class="name tag">&quot;unsigned&quot;</span><span class="punctuation">:</span> <span class="punctuation">{</span>
        <span class="name tag">&quot;age&quot;</span><span class="punctuation">:</span> <span class="literal number integer">1234</span>
      <span class="punctuation">},</span>
      <span class="name tag">&quot;state_key&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;&#64;alice:example.org&quot;</span>
    <span class="punctuation">},</span>
    <span class="punctuation">{</span>
      <span class="name tag">&quot;content&quot;</span><span class="punctuation">:</span> <span class="punctuation">{</span>
        <span class="name tag">&quot;body&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;This is an example text message&quot;</span><span class="punctuation">,</span>
        <span class="name tag">&quot;msgtype&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;m.text&quot;</span><span class="punctuation">,</span>
        <span class="name tag">&quot;format&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;org.matrix.custom.html&quot;</span><span class="punctuation">,</span>
        <span class="name tag">&quot;formatted_body&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;&lt;b&gt;This is an example text message&lt;/b&gt;&quot;</span>
      <span class="punctuation">},</span>
      <span class="name tag">&quot;type&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;m.room.message&quot;</span><span class="punctuation">,</span>
      <span class="name tag">&quot;event_id&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;$143273582443PhrSn:example.org&quot;</span><span class="punctuation">,</span>
      <span class="name tag">&quot;room_id&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;!jEsUZKDJdhlrceRyVU:example.org&quot;</span><span class="punctuation">,</span>
      <span class="name tag">&quot;sender&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;&#64;example:example.org&quot;</span><span class="punctuation">,</span>
      <span class="name tag">&quot;origin_server_ts&quot;</span><span class="punctuation">:</span> <span class="literal number integer">1432735824653</span><span class="punctuation">,</span>
      <span class="name tag">&quot;unsigned&quot;</span><span class="punctuation">:</span> <span class="punctuation">{</span>
        <span class="name tag">&quot;age&quot;</span><span class="punctuation">:</span> <span class="literal number integer">1234</span>
      <span class="punctuation">}</span>
    <span class="punctuation">}</span>
  <span class="punctuation">]</span>
<span class="punctuation">}</span>
</pre>
<p class="httpheaders">Response:</p>
<p><strong>Status code 200:</strong></p>
<p>The transaction was processed successfully.</p>
<p class="httpheaders">Example</p>
<pre class="code json literal-block">
<span class="punctuation">{}</span>
</pre>
</div>
</div>
<p><a class="anchor" id="querying"></a></p>
<div class="section" id="querying">
<h3><a class="toc-backref" href="#id12">2.2.4&nbsp;&nbsp;&nbsp;Querying</a></h3>
<p>The application service API includes two querying APIs: for room aliases and for
user IDs. The application service SHOULD create the queried entity if it desires.
During this process, the application service is blocking the homeserver until the
entity is created and configured. If the homeserver does not receive a response
to this request, the homeserver should retry several times before timing out. This
should result in an HTTP status 408 &quot;Request Timeout&quot; on the client which initiated
this request (e.g. to join a room alias).</p>
<div class="admonition admonition-rationale">
<p class="first admonition-title">Rationale</p>
<p class="last">Blocking the homeserver and expecting the application service to create the entity
using the client-server API is simpler and more flexible than alternative methods
such as returning an initial sync style JSON blob and get the HS to provision
the room/user. This also meant that there didn't need to be a &quot;backchannel&quot; to inform
the application service about information about the entity such as room ID to
room alias mappings.</p>
</div>
<p><a class="anchor" id="get-matrix-app-v1-users-userid"></a></p>
<div class="section" id="get-matrix-app-v1-users-userid">
<h4><a class="toc-backref" href="#id13">2.2.4.1&nbsp;&nbsp;&nbsp;<tt class="docutils literal">GET <span class="pre">/_matrix/app/v1/users/{userId}</span></tt></a></h4>
<p>This endpoint is invoked by the homeserver on an application service to query
the existence of a given user ID. The homeserver will only query user IDs
inside the application service's <tt class="docutils literal">users</tt> namespace. The homeserver will
send this request when it receives an event for an unknown user ID in
the application service's namespace, such as a room invite.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Rate-limited:</th><td class="field-body">No.</td>
</tr>
<tr class="field"><th class="field-name">Requires auth:</th><td class="field-body">Yes.</td>
</tr>
</tbody>
</table>
<p class="httpheaders">Request format:</p>
<table border="1" class="colwidths-auto docutils">
<thead valign="bottom">
<tr><th class="head">Parameter</th>
<th class="head">Type</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr><td colspan="3"><em>path parameters</em></td>
</tr>
<tr><td>userId</td>
<td>string</td>
<td><strong>Required.</strong> The user ID being queried.</td>
</tr>
</tbody>
</table>
<p class="httpheaders">Example request:</p>
<pre class="code http literal-block">
<span class="name function">GET</span> <span class="name namespace">/_matrix/app/v1/users/%40alice%3Aexample.com</span> <span class="keyword reserved">HTTP</span><span class="operator">/</span><span class="literal number">1.1</span>
</pre>
<p class="httpheaders">Responses:</p>
<p><strong>Status code 200:</strong></p>
<p>The application service indicates that this user exists. The application
service MUST create the user using the client-server API.</p>
<p class="httpheaders">Example</p>
<pre class="code json literal-block">
<span class="punctuation">{}</span>
</pre>
<p><strong>Status code 401:</strong></p>
<p>The homeserver has not supplied credentials to the application service.
Optional error information can be included in the body of this response.</p>
<p class="httpheaders">Example</p>
<pre class="code json literal-block">
<span class="punctuation">{</span>
  <span class="name tag">&quot;errcode&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;COM.EXAMPLE.MYAPPSERVICE_UNAUTHORIZED&quot;</span>
<span class="punctuation">}</span>
</pre>
<p><strong>Status code 403:</strong></p>
<p>The credentials supplied by the homeserver were rejected.</p>
<p class="httpheaders">Example</p>
<pre class="code json literal-block">
<span class="punctuation">{</span>
  <span class="name tag">&quot;errcode&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;COM.EXAMPLE.MYAPPSERVICE_FORBIDDEN&quot;</span>
<span class="punctuation">}</span>
</pre>
<p><strong>Status code 404:</strong></p>
<p>The application service indicates that this user does not exist.
Optional error information can be included in the body of this response.</p>
<p class="httpheaders">Example</p>
<pre class="code json literal-block">
<span class="punctuation">{</span>
  <span class="name tag">&quot;errcode&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;COM.EXAMPLE.MYAPPSERVICE_NOT_FOUND&quot;</span>
<span class="punctuation">}</span>
</pre>
</div>
<p><a class="anchor" id="get-matrix-app-v1-rooms-roomalias"></a></p>
<div class="section" id="get-matrix-app-v1-rooms-roomalias">
<h4><a class="toc-backref" href="#id14">2.2.4.2&nbsp;&nbsp;&nbsp;<tt class="docutils literal">GET <span class="pre">/_matrix/app/v1/rooms/{roomAlias}</span></tt></a></h4>
<p>This endpoint is invoked by the homeserver on an application service to query
the existence of a given room alias. The homeserver will only query room
aliases inside the application service's <tt class="docutils literal">aliases</tt> namespace. The
homeserver will send this request when it receives a request to join a
room alias within the application service's namespace.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Rate-limited:</th><td class="field-body">No.</td>
</tr>
<tr class="field"><th class="field-name">Requires auth:</th><td class="field-body">Yes.</td>
</tr>
</tbody>
</table>
<p class="httpheaders">Request format:</p>
<table border="1" class="colwidths-auto docutils">
<thead valign="bottom">
<tr><th class="head">Parameter</th>
<th class="head">Type</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr><td colspan="3"><em>path parameters</em></td>
</tr>
<tr><td>roomAlias</td>
<td>string</td>
<td><strong>Required.</strong> The room alias being queried.</td>
</tr>
</tbody>
</table>
<p class="httpheaders">Example request:</p>
<pre class="code http literal-block">
<span class="name function">GET</span> <span class="name namespace">/_matrix/app/v1/rooms/%23magicforest%3Aexample.com</span> <span class="keyword reserved">HTTP</span><span class="operator">/</span><span class="literal number">1.1</span>
</pre>
<p class="httpheaders">Responses:</p>
<p><strong>Status code 200:</strong></p>
<p>The application service indicates that this room alias exists. The
application service MUST have created a room and associated it with
the queried room alias using the client-server API. Additional
information about the room such as its name and topic can be set
before responding.</p>
<p class="httpheaders">Example</p>
<pre class="code json literal-block">
<span class="punctuation">{}</span>
</pre>
<p><strong>Status code 401:</strong></p>
<p>The homeserver has not supplied credentials to the application service.
Optional error information can be included in the body of this response.</p>
<p class="httpheaders">Example</p>
<pre class="code json literal-block">
<span class="punctuation">{</span>
  <span class="name tag">&quot;errcode&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;COM.EXAMPLE.MYAPPSERVICE_UNAUTHORIZED&quot;</span>
<span class="punctuation">}</span>
</pre>
<p><strong>Status code 403:</strong></p>
<p>The credentials supplied by the homeserver were rejected.</p>
<p class="httpheaders">Example</p>
<pre class="code json literal-block">
<span class="punctuation">{</span>
  <span class="name tag">&quot;errcode&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;COM.EXAMPLE.MYAPPSERVICE_FORBIDDEN&quot;</span>
<span class="punctuation">}</span>
</pre>
<p><strong>Status code 404:</strong></p>
<p>The application service indicates that this room alias does not exist.
Optional error information can be included in the body of this response.</p>
<p class="httpheaders">Example</p>
<pre class="code json literal-block">
<span class="punctuation">{</span>
  <span class="name tag">&quot;errcode&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;COM.EXAMPLE.MYAPPSERVICE_NOT_FOUND&quot;</span>
<span class="punctuation">}</span>
</pre>
</div>
</div>
<p><a class="anchor" id="third-party-networks"></a></p>
<div class="section" id="third-party-networks">
<h3><a class="toc-backref" href="#id15">2.2.5&nbsp;&nbsp;&nbsp;Third party networks</a></h3>
<p>Application services may declare which protocols they support via their registration
configuration for the homeserver. These networks are generally for third party services
such as IRC that the application service is managing. Application services may populate
a Matrix room directory for their registered protocols, as defined in the Client-Server
API Extensions.</p>
<p>Each protocol may have several &quot;locations&quot; (also known as &quot;third party locations&quot; or &quot;3PLs&quot;).
A location within a protocol is a place in the third party network, such as an IRC channel.
Users of the third party network may also be represented by the application service.</p>
<p>Locations and users can be searched by fields defined by the application service, such
as by display name or other attribute. When clients request the homeserver to search
in a particular &quot;network&quot; (protocol), the search fields will be passed along to the
application service for filtering.</p>
<p><a class="anchor" id="get-matrix-app-v1-thirdparty-protocol-protocol"></a></p>
<div class="section" id="get-matrix-app-v1-thirdparty-protocol-protocol">
<h4><a class="toc-backref" href="#id16">2.2.5.1&nbsp;&nbsp;&nbsp;<tt class="docutils literal">GET <span class="pre">/_matrix/app/v1/thirdparty/protocol/{protocol}</span></tt></a></h4>
<p>This API is called by the homeserver when it wants to present clients
with specific information about the various third party networks that
an application service supports.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Rate-limited:</th><td class="field-body">No.</td>
</tr>
<tr class="field"><th class="field-name">Requires auth:</th><td class="field-body">Yes.</td>
</tr>
</tbody>
</table>
<p class="httpheaders">Request format:</p>
<table border="1" class="colwidths-auto docutils">
<thead valign="bottom">
<tr><th class="head">Parameter</th>
<th class="head">Type</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr><td colspan="3"><em>path parameters</em></td>
</tr>
<tr><td>protocol</td>
<td>string</td>
<td><strong>Required.</strong> The protocol ID.</td>
</tr>
</tbody>
</table>
<p class="httpheaders">Response format:</p>
<table border="1" class="colwidths-auto docutils">
<caption>Protocol</caption>
<thead valign="bottom">
<tr><th class="head">Parameter</th>
<th class="head">Type</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>user_fields</td>
<td>[string]</td>
<td><strong>Required.</strong> Fields which may be used to identify
a third party user. These should be ordered to
suggest the way that entities may be grouped,
where higher groupings are ordered first. For
example, the name of a network should be searched
before the nickname of a user.</td>
</tr>
<tr><td>location_fields</td>
<td>[string]</td>
<td><strong>Required.</strong> Fields which may be used to identify
a third party location. These should be ordered to
suggest the way that entities may be grouped,
where higher groupings are ordered first. For
example, the name of a network should be searched
before the name of a channel.</td>
</tr>
<tr><td>icon</td>
<td>string</td>
<td><strong>Required.</strong> A content URI representing an icon
for the third party protocol.</td>
</tr>
<tr><td>field_types</td>
<td>{string: Field Type}</td>
<td><p class="first"><strong>Required.</strong> The type definitions for the fields
defined in the <tt class="docutils literal">user_fields</tt> and
<tt class="docutils literal">location_fields</tt>. Each entry in those arrays
MUST have an entry here. The <tt class="docutils literal">string</tt> key for
this object is field name itself.</p>
<p class="last">May be an empty object if no fields are defined.</p>
</td>
</tr>
<tr><td>instances</td>
<td>[Protocol Instance]</td>
<td><strong>Required.</strong> A list of objects representing
independent instances of configuration. For
example, multiple networks on IRC if multiple are
provided by the same application service.</td>
</tr>
</tbody>
</table>
<table border="1" class="colwidths-auto docutils">
<caption>Field Type</caption>
<thead valign="bottom">
<tr><th class="head">Parameter</th>
<th class="head">Type</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>regexp</td>
<td>string</td>
<td><strong>Required.</strong> A regular expression for validation
of a field's value. This may be relatively coarse
to verify the value as the application service
providing this protocol may apply additional
validation or filtering.</td>
</tr>
<tr><td>placeholder</td>
<td>string</td>
<td><strong>Required.</strong> An placeholder serving as a valid
example of the field value.</td>
</tr>
</tbody>
</table>
<table border="1" class="colwidths-auto docutils">
<caption>Protocol Instance</caption>
<thead valign="bottom">
<tr><th class="head">Parameter</th>
<th class="head">Type</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>desc</td>
<td>string</td>
<td><strong>Required.</strong> A human-readable description for the
protocol, such as the name.</td>
</tr>
<tr><td>icon</td>
<td>string</td>
<td>An optional content URI representing the protocol.
Overrides the one provided at the higher level
Protocol object.</td>
</tr>
<tr><td>fields</td>
<td>object</td>
<td><strong>Required.</strong> Preset values for <tt class="docutils literal">fields</tt> the
client may use to search by.</td>
</tr>
<tr><td>network_id</td>
<td>string</td>
<td><strong>Required.</strong> A unique identifier across all
instances.</td>
</tr>
</tbody>
</table>
<p class="httpheaders">Example request:</p>
<pre class="code http literal-block">
<span class="name function">GET</span> <span class="name namespace">/_matrix/app/v1/thirdparty/protocol/irc</span> <span class="keyword reserved">HTTP</span><span class="operator">/</span><span class="literal number">1.1</span>
</pre>
<p class="httpheaders">Responses:</p>
<p><strong>Status code 200:</strong></p>
<p>The protocol was found and metadata returned.</p>
<p class="httpheaders">Example</p>
<pre class="code json literal-block">
<span class="punctuation">{</span>
  <span class="name tag">&quot;irc&quot;</span><span class="punctuation">:</span> <span class="punctuation">{</span>
    <span class="name tag">&quot;user_fields&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span>
      <span class="literal string double">&quot;network&quot;</span><span class="punctuation">,</span>
      <span class="literal string double">&quot;nickname&quot;</span>
    <span class="punctuation">],</span>
    <span class="name tag">&quot;location_fields&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span>
      <span class="literal string double">&quot;network&quot;</span><span class="punctuation">,</span>
      <span class="literal string double">&quot;channel&quot;</span>
    <span class="punctuation">],</span>
    <span class="name tag">&quot;icon&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;mxc://example.org/aBcDeFgH&quot;</span><span class="punctuation">,</span>
    <span class="name tag">&quot;field_types&quot;</span><span class="punctuation">:</span> <span class="punctuation">{</span>
      <span class="name tag">&quot;network&quot;</span><span class="punctuation">:</span> <span class="punctuation">{</span>
        <span class="name tag">&quot;regexp&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;([a-z0-9]+\\.)*[a-z0-9]+&quot;</span><span class="punctuation">,</span>
        <span class="name tag">&quot;placeholder&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;irc.example.org&quot;</span>
      <span class="punctuation">},</span>
      <span class="name tag">&quot;nickname&quot;</span><span class="punctuation">:</span> <span class="punctuation">{</span>
        <span class="name tag">&quot;regexp&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;[^\\s]+&quot;</span><span class="punctuation">,</span>
        <span class="name tag">&quot;placeholder&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;username&quot;</span>
      <span class="punctuation">},</span>
      <span class="name tag">&quot;channel&quot;</span><span class="punctuation">:</span> <span class="punctuation">{</span>
        <span class="name tag">&quot;regexp&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;#[^\\s]+&quot;</span><span class="punctuation">,</span>
        <span class="name tag">&quot;placeholder&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;#foobar&quot;</span>
      <span class="punctuation">}</span>
    <span class="punctuation">},</span>
    <span class="name tag">&quot;instances&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span>
      <span class="punctuation">{</span>
        <span class="name tag">&quot;network_id&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;freenode&quot;</span><span class="punctuation">,</span>
        <span class="name tag">&quot;desc&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;Freenode&quot;</span><span class="punctuation">,</span>
        <span class="name tag">&quot;icon&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;mxc://example.org/JkLmNoPq&quot;</span><span class="punctuation">,</span>
        <span class="name tag">&quot;fields&quot;</span><span class="punctuation">:</span> <span class="punctuation">{</span>
          <span class="name tag">&quot;network&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;freenode.net&quot;</span>
        <span class="punctuation">}</span>
      <span class="punctuation">}</span>
    <span class="punctuation">]</span>
  <span class="punctuation">},</span>
  <span class="name tag">&quot;gitter&quot;</span><span class="punctuation">:</span> <span class="punctuation">{</span>
    <span class="name tag">&quot;user_fields&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span>
      <span class="literal string double">&quot;username&quot;</span>
    <span class="punctuation">],</span>
    <span class="name tag">&quot;location_fields&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span>
      <span class="literal string double">&quot;room&quot;</span>
    <span class="punctuation">],</span>
    <span class="name tag">&quot;field_types&quot;</span><span class="punctuation">:</span> <span class="punctuation">{</span>
      <span class="name tag">&quot;username&quot;</span><span class="punctuation">:</span> <span class="punctuation">{</span>
        <span class="name tag">&quot;regexp&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;&#64;[^\\s]+&quot;</span><span class="punctuation">,</span>
        <span class="name tag">&quot;placeholder&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;&#64;username&quot;</span>
      <span class="punctuation">},</span>
      <span class="name tag">&quot;room&quot;</span><span class="punctuation">:</span> <span class="punctuation">{</span>
        <span class="name tag">&quot;regexp&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;[^\\s]+\\/[^\\s]+&quot;</span><span class="punctuation">,</span>
        <span class="name tag">&quot;placeholder&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;matrix-org/matrix-doc&quot;</span>
      <span class="punctuation">}</span>
    <span class="punctuation">},</span>
    <span class="name tag">&quot;instances&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span>
      <span class="punctuation">{</span>
        <span class="name tag">&quot;network_id&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;gitter&quot;</span><span class="punctuation">,</span>
        <span class="name tag">&quot;desc&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;Gitter&quot;</span><span class="punctuation">,</span>
        <span class="name tag">&quot;icon&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;mxc://example.org/zXyWvUt&quot;</span><span class="punctuation">,</span>
        <span class="name tag">&quot;fields&quot;</span><span class="punctuation">:</span> <span class="punctuation">{}</span>
      <span class="punctuation">}</span>
    <span class="punctuation">]</span>
  <span class="punctuation">}</span>
<span class="punctuation">}</span>
</pre>
<p><strong>Status code 401:</strong></p>
<p>The homeserver has not supplied credentials to the application service.
Optional error information can be included in the body of this response.</p>
<p class="httpheaders">Example</p>
<pre class="code json literal-block">
<span class="punctuation">{</span>
  <span class="name tag">&quot;errcode&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;COM.EXAMPLE.MYAPPSERVICE_UNAUTHORIZED&quot;</span>
<span class="punctuation">}</span>
</pre>
<p><strong>Status code 403:</strong></p>
<p>The credentials supplied by the homeserver were rejected.</p>
<p class="httpheaders">Example</p>
<pre class="code json literal-block">
<span class="punctuation">{</span>
  <span class="name tag">&quot;errcode&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;COM.EXAMPLE.MYAPPSERVICE_FORBIDDEN&quot;</span>
<span class="punctuation">}</span>
</pre>
<p><strong>Status code 404:</strong></p>
<p>No protocol was found with the given path.</p>
<p class="httpheaders">Example</p>
<pre class="code json literal-block">
<span class="punctuation">{</span>
  <span class="name tag">&quot;errcode&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;COM.EXAMPLE.MYAPPSERVICE_NOT_FOUND&quot;</span>
<span class="punctuation">}</span>
</pre>
</div>
<p><a class="anchor" id="get-matrix-app-v1-thirdparty-user-protocol"></a></p>
<div class="section" id="get-matrix-app-v1-thirdparty-user-protocol">
<h4><a class="toc-backref" href="#id17">2.2.5.2&nbsp;&nbsp;&nbsp;<tt class="docutils literal">GET <span class="pre">/_matrix/app/v1/thirdparty/user/{protocol}</span></tt></a></h4>
<p>This API is called by the homeserver in order to retrieve a Matrix
User ID linked to a user on the third party network, given a set of
user parameters.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Rate-limited:</th><td class="field-body">No.</td>
</tr>
<tr class="field"><th class="field-name">Requires auth:</th><td class="field-body">Yes.</td>
</tr>
</tbody>
</table>
<p class="httpheaders">Request format:</p>
<table border="1" class="colwidths-auto docutils">
<thead valign="bottom">
<tr><th class="head">Parameter</th>
<th class="head">Type</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr><td colspan="3"><em>path parameters</em></td>
</tr>
<tr><td>protocol</td>
<td>string</td>
<td><strong>Required.</strong> The protocol ID.</td>
</tr>
<tr><td colspan="3"><em>query parameters</em></td>
</tr>
<tr><td>fields...</td>
<td>string</td>
<td>One or more custom fields that are passed to the
application service to help identify the user.</td>
</tr>
</tbody>
</table>
<p class="httpheaders">Response format:</p>
<table border="1" class="colwidths-auto docutils">
<thead valign="bottom">
<tr><th class="head">Parameter</th>
<th class="head">Type</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>&lt;body&gt;</td>
<td>[User]</td>
<td>List of matched third party users.</td>
</tr>
</tbody>
</table>
<table border="1" class="colwidths-auto docutils">
<caption>User</caption>
<thead valign="bottom">
<tr><th class="head">Parameter</th>
<th class="head">Type</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>userid</td>
<td>string</td>
<td><strong>Required.</strong> A Matrix User ID represting a third
party user.</td>
</tr>
<tr><td>protocol</td>
<td>string</td>
<td><strong>Required.</strong> The protocol ID that the third party
location is a part of.</td>
</tr>
<tr><td>fields</td>
<td>object</td>
<td><strong>Required.</strong> Information used to identify this
third party location.</td>
</tr>
</tbody>
</table>
<p class="httpheaders">Example request:</p>
<pre class="code http literal-block">
<span class="name function">GET</span> <span class="name namespace">/_matrix/app/v1/thirdparty/user/irc</span> <span class="keyword reserved">HTTP</span><span class="operator">/</span><span class="literal number">1.1</span>
</pre>
<p class="httpheaders">Responses:</p>
<p><strong>Status code 200:</strong></p>
<p>The Matrix User IDs found with the given parameters.</p>
<p class="httpheaders">Example</p>
<pre class="code json literal-block">
<span class="punctuation">[</span>
  <span class="punctuation">{</span>
    <span class="name tag">&quot;userid&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;&#64;_gitter_jim:matrix.org&quot;</span><span class="punctuation">,</span>
    <span class="name tag">&quot;protocol&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;gitter&quot;</span><span class="punctuation">,</span>
    <span class="name tag">&quot;fields&quot;</span><span class="punctuation">:</span> <span class="punctuation">{</span>
      <span class="name tag">&quot;user&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;jim&quot;</span>
    <span class="punctuation">}</span>
  <span class="punctuation">}</span>
<span class="punctuation">]</span>
</pre>
<p><strong>Status code 401:</strong></p>
<p>The homeserver has not supplied credentials to the application service.
Optional error information can be included in the body of this response.</p>
<p class="httpheaders">Example</p>
<pre class="code json literal-block">
<span class="punctuation">{</span>
  <span class="name tag">&quot;errcode&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;COM.EXAMPLE.MYAPPSERVICE_UNAUTHORIZED&quot;</span>
<span class="punctuation">}</span>
</pre>
<p><strong>Status code 403:</strong></p>
<p>The credentials supplied by the homeserver were rejected.</p>
<p class="httpheaders">Example</p>
<pre class="code json literal-block">
<span class="punctuation">{</span>
  <span class="name tag">&quot;errcode&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;COM.EXAMPLE.MYAPPSERVICE_FORBIDDEN&quot;</span>
<span class="punctuation">}</span>
</pre>
<p><strong>Status code 404:</strong></p>
<p>No users were found with the given parameters.</p>
<p class="httpheaders">Example</p>
<pre class="code json literal-block">
<span class="punctuation">{</span>
  <span class="name tag">&quot;errcode&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;COM.EXAMPLE.MYAPPSERVICE_NOT_FOUND&quot;</span>
<span class="punctuation">}</span>
</pre>
</div>
<p><a class="anchor" id="get-matrix-app-v1-thirdparty-location-protocol"></a></p>
<div class="section" id="get-matrix-app-v1-thirdparty-location-protocol">
<h4><a class="toc-backref" href="#id18">2.2.5.3&nbsp;&nbsp;&nbsp;<tt class="docutils literal">GET <span class="pre">/_matrix/app/v1/thirdparty/location/{protocol}</span></tt></a></h4>
<p>Retrieve a list of Matrix portal rooms that lead to the matched third party location.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Rate-limited:</th><td class="field-body">No.</td>
</tr>
<tr class="field"><th class="field-name">Requires auth:</th><td class="field-body">Yes.</td>
</tr>
</tbody>
</table>
<p class="httpheaders">Request format:</p>
<table border="1" class="colwidths-auto docutils">
<thead valign="bottom">
<tr><th class="head">Parameter</th>
<th class="head">Type</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr><td colspan="3"><em>path parameters</em></td>
</tr>
<tr><td>protocol</td>
<td>string</td>
<td><strong>Required.</strong> The protocol ID.</td>
</tr>
<tr><td colspan="3"><em>query parameters</em></td>
</tr>
<tr><td>fields...</td>
<td>string</td>
<td>One or more custom fields that are passed to the
application service to help identify the third
party location.</td>
</tr>
</tbody>
</table>
<p class="httpheaders">Response format:</p>
<table border="1" class="colwidths-auto docutils">
<thead valign="bottom">
<tr><th class="head">Parameter</th>
<th class="head">Type</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>&lt;body&gt;</td>
<td>[Location]</td>
<td>List of matched third party locations.</td>
</tr>
</tbody>
</table>
<table border="1" class="colwidths-auto docutils">
<caption>Location</caption>
<thead valign="bottom">
<tr><th class="head">Parameter</th>
<th class="head">Type</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>alias</td>
<td>string</td>
<td><strong>Required.</strong> An alias for a matrix room.</td>
</tr>
<tr><td>protocol</td>
<td>string</td>
<td><strong>Required.</strong> The protocol ID that the third party
location is a part of.</td>
</tr>
<tr><td>fields</td>
<td>object</td>
<td><strong>Required.</strong> Information used to identify this
third party location.</td>
</tr>
</tbody>
</table>
<p class="httpheaders">Example request:</p>
<pre class="code http literal-block">
<span class="name function">GET</span> <span class="name namespace">/_matrix/app/v1/thirdparty/location/irc</span> <span class="keyword reserved">HTTP</span><span class="operator">/</span><span class="literal number">1.1</span>
</pre>
<p class="httpheaders">Responses:</p>
<p><strong>Status code 200:</strong></p>
<p>At least one portal room was found.</p>
<p class="httpheaders">Example</p>
<pre class="code json literal-block">
<span class="punctuation">[</span>
  <span class="punctuation">{</span>
    <span class="name tag">&quot;alias&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;#freenode_#matrix:matrix.org&quot;</span><span class="punctuation">,</span>
    <span class="name tag">&quot;protocol&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;irc&quot;</span><span class="punctuation">,</span>
    <span class="name tag">&quot;fields&quot;</span><span class="punctuation">:</span> <span class="punctuation">{</span>
      <span class="name tag">&quot;network&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;freenode&quot;</span><span class="punctuation">,</span>
      <span class="name tag">&quot;channel&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;#matrix&quot;</span>
    <span class="punctuation">}</span>
  <span class="punctuation">}</span>
<span class="punctuation">]</span>
</pre>
<p><strong>Status code 401:</strong></p>
<p>The homeserver has not supplied credentials to the application service.
Optional error information can be included in the body of this response.</p>
<p class="httpheaders">Example</p>
<pre class="code json literal-block">
<span class="punctuation">{</span>
  <span class="name tag">&quot;errcode&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;COM.EXAMPLE.MYAPPSERVICE_UNAUTHORIZED&quot;</span>
<span class="punctuation">}</span>
</pre>
<p><strong>Status code 403:</strong></p>
<p>The credentials supplied by the homeserver were rejected.</p>
<p class="httpheaders">Example</p>
<pre class="code json literal-block">
<span class="punctuation">{</span>
  <span class="name tag">&quot;errcode&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;COM.EXAMPLE.MYAPPSERVICE_FORBIDDEN&quot;</span>
<span class="punctuation">}</span>
</pre>
<p><strong>Status code 404:</strong></p>
<p>No mappings were found with the given parameters.</p>
<p class="httpheaders">Example</p>
<pre class="code json literal-block">
<span class="punctuation">{</span>
  <span class="name tag">&quot;errcode&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;COM.EXAMPLE.MYAPPSERVICE_NOT_FOUND&quot;</span>
<span class="punctuation">}</span>
</pre>
</div>
<p><a class="anchor" id="get-matrix-app-v1-thirdparty-location"></a></p>
<div class="section" id="get-matrix-app-v1-thirdparty-location">
<h4><a class="toc-backref" href="#id19">2.2.5.4&nbsp;&nbsp;&nbsp;<tt class="docutils literal">GET /_matrix/app/v1/thirdparty/location</tt></a></h4>
<p>Retrieve an array of third party network locations from a Matrix room
alias.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Rate-limited:</th><td class="field-body">No.</td>
</tr>
<tr class="field"><th class="field-name">Requires auth:</th><td class="field-body">Yes.</td>
</tr>
</tbody>
</table>
<p class="httpheaders">Request format:</p>
<table border="1" class="colwidths-auto docutils">
<thead valign="bottom">
<tr><th class="head">Parameter</th>
<th class="head">Type</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr><td colspan="3"><em>query parameters</em></td>
</tr>
<tr><td>alias</td>
<td>string</td>
<td>The Matrix room alias to look up.</td>
</tr>
</tbody>
</table>
<p class="httpheaders">Response format:</p>
<table border="1" class="colwidths-auto docutils">
<thead valign="bottom">
<tr><th class="head">Parameter</th>
<th class="head">Type</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>&lt;body&gt;</td>
<td>[Location]</td>
<td>List of matched third party locations.</td>
</tr>
</tbody>
</table>
<table border="1" class="colwidths-auto docutils">
<caption>Location</caption>
<thead valign="bottom">
<tr><th class="head">Parameter</th>
<th class="head">Type</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>alias</td>
<td>string</td>
<td><strong>Required.</strong> An alias for a matrix room.</td>
</tr>
<tr><td>protocol</td>
<td>string</td>
<td><strong>Required.</strong> The protocol ID that the third party
location is a part of.</td>
</tr>
<tr><td>fields</td>
<td>object</td>
<td><strong>Required.</strong> Information used to identify this
third party location.</td>
</tr>
</tbody>
</table>
<p class="httpheaders">Example request:</p>
<pre class="code http literal-block">
<span class="name function">GET</span> <span class="name namespace">/_matrix/app/v1/thirdparty/location</span> <span class="keyword reserved">HTTP</span><span class="operator">/</span><span class="literal number">1.1</span>
</pre>
<p class="httpheaders">Responses:</p>
<p><strong>Status code 200:</strong></p>
<p>All found third party locations.</p>
<p class="httpheaders">Example</p>
<pre class="code json literal-block">
<span class="punctuation">[</span>
  <span class="punctuation">{</span>
    <span class="name tag">&quot;alias&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;#freenode_#matrix:matrix.org&quot;</span><span class="punctuation">,</span>
    <span class="name tag">&quot;protocol&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;irc&quot;</span><span class="punctuation">,</span>
    <span class="name tag">&quot;fields&quot;</span><span class="punctuation">:</span> <span class="punctuation">{</span>
      <span class="name tag">&quot;network&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;freenode&quot;</span><span class="punctuation">,</span>
      <span class="name tag">&quot;channel&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;#matrix&quot;</span>
    <span class="punctuation">}</span>
  <span class="punctuation">}</span>
<span class="punctuation">]</span>
</pre>
<p><strong>Status code 401:</strong></p>
<p>The homeserver has not supplied credentials to the application service.
Optional error information can be included in the body of this response.</p>
<p class="httpheaders">Example</p>
<pre class="code json literal-block">
<span class="punctuation">{</span>
  <span class="name tag">&quot;errcode&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;COM.EXAMPLE.MYAPPSERVICE_UNAUTHORIZED&quot;</span>
<span class="punctuation">}</span>
</pre>
<p><strong>Status code 403:</strong></p>
<p>The credentials supplied by the homeserver were rejected.</p>
<p class="httpheaders">Example</p>
<pre class="code json literal-block">
<span class="punctuation">{</span>
  <span class="name tag">&quot;errcode&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;COM.EXAMPLE.MYAPPSERVICE_FORBIDDEN&quot;</span>
<span class="punctuation">}</span>
</pre>
<p><strong>Status code 404:</strong></p>
<p>No mappings were found with the given parameters.</p>
<p class="httpheaders">Example</p>
<pre class="code json literal-block">
<span class="punctuation">{</span>
  <span class="name tag">&quot;errcode&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;COM.EXAMPLE.MYAPPSERVICE_NOT_FOUND&quot;</span>
<span class="punctuation">}</span>
</pre>
</div>
<p><a class="anchor" id="get-matrix-app-v1-thirdparty-user"></a></p>
<div class="section" id="get-matrix-app-v1-thirdparty-user">
<h4><a class="toc-backref" href="#id20">2.2.5.5&nbsp;&nbsp;&nbsp;<tt class="docutils literal">GET /_matrix/app/v1/thirdparty/user</tt></a></h4>
<p>Retrieve an array of third party users from a Matrix User ID.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Rate-limited:</th><td class="field-body">No.</td>
</tr>
<tr class="field"><th class="field-name">Requires auth:</th><td class="field-body">Yes.</td>
</tr>
</tbody>
</table>
<p class="httpheaders">Request format:</p>
<table border="1" class="colwidths-auto docutils">
<thead valign="bottom">
<tr><th class="head">Parameter</th>
<th class="head">Type</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr><td colspan="3"><em>query parameters</em></td>
</tr>
<tr><td>userid</td>
<td>string</td>
<td>The Matrix User ID to look up.</td>
</tr>
</tbody>
</table>
<p class="httpheaders">Response format:</p>
<table border="1" class="colwidths-auto docutils">
<thead valign="bottom">
<tr><th class="head">Parameter</th>
<th class="head">Type</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>&lt;body&gt;</td>
<td>[User]</td>
<td>List of matched third party users.</td>
</tr>
</tbody>
</table>
<table border="1" class="colwidths-auto docutils">
<caption>User</caption>
<thead valign="bottom">
<tr><th class="head">Parameter</th>
<th class="head">Type</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>userid</td>
<td>string</td>
<td><strong>Required.</strong> A Matrix User ID represting a third
party user.</td>
</tr>
<tr><td>protocol</td>
<td>string</td>
<td><strong>Required.</strong> The protocol ID that the third party
location is a part of.</td>
</tr>
<tr><td>fields</td>
<td>object</td>
<td><strong>Required.</strong> Information used to identify this
third party location.</td>
</tr>
</tbody>
</table>
<p class="httpheaders">Example request:</p>
<pre class="code http literal-block">
<span class="name function">GET</span> <span class="name namespace">/_matrix/app/v1/thirdparty/user</span> <span class="keyword reserved">HTTP</span><span class="operator">/</span><span class="literal number">1.1</span>
</pre>
<p class="httpheaders">Responses:</p>
<p><strong>Status code 200:</strong></p>
<p>An array of third party users.</p>
<p class="httpheaders">Example</p>
<pre class="code json literal-block">
<span class="punctuation">[</span>
  <span class="punctuation">{</span>
    <span class="name tag">&quot;userid&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;&#64;_gitter_jim:matrix.org&quot;</span><span class="punctuation">,</span>
    <span class="name tag">&quot;protocol&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;gitter&quot;</span><span class="punctuation">,</span>
    <span class="name tag">&quot;fields&quot;</span><span class="punctuation">:</span> <span class="punctuation">{</span>
      <span class="name tag">&quot;user&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;jim&quot;</span>
    <span class="punctuation">}</span>
  <span class="punctuation">}</span>
<span class="punctuation">]</span>
</pre>
<p><strong>Status code 401:</strong></p>
<p>The homeserver has not supplied credentials to the application service.
Optional error information can be included in the body of this response.</p>
<p class="httpheaders">Example</p>
<pre class="code json literal-block">
<span class="punctuation">{</span>
  <span class="name tag">&quot;errcode&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;COM.EXAMPLE.MYAPPSERVICE_UNAUTHORIZED&quot;</span>
<span class="punctuation">}</span>
</pre>
<p><strong>Status code 403:</strong></p>
<p>The credentials supplied by the homeserver were rejected.</p>
<p class="httpheaders">Example</p>
<pre class="code json literal-block">
<span class="punctuation">{</span>
  <span class="name tag">&quot;errcode&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;COM.EXAMPLE.MYAPPSERVICE_UNAUTHORIZED&quot;</span>
<span class="punctuation">}</span>
</pre>
<p><strong>Status code 404:</strong></p>
<p>No mappings were found with the given parameters.</p>
<p class="httpheaders">Example</p>
<pre class="code json literal-block">
<span class="punctuation">{</span>
  <span class="name tag">&quot;errcode&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;COM.EXAMPLE.MYAPPSERVICE_NOT_FOUND&quot;</span>
<span class="punctuation">}</span>
</pre>
</div>
</div>
</div>
<p><a class="anchor" id="client-server-api-extensions"></a></p>
<div class="section" id="client-server-api-extensions">
<h2><a class="toc-backref" href="#id21">2.3&nbsp;&nbsp;&nbsp;Client-Server API Extensions</a></h2>
<p>Application services can use a more powerful version of the
client-server API by identifying itself as an application service to the
homeserver.</p>
<p>Endpoints defined in this section MUST be supported by homeservers in the
client-server API as accessible only by application services.</p>
<p><a class="anchor" id="identity-assertion"></a></p>
<div class="section" id="identity-assertion">
<h3><a class="toc-backref" href="#id22">2.3.1&nbsp;&nbsp;&nbsp;Identity assertion</a></h3>
<p>The client-server API infers the user ID from the <tt class="docutils literal">access_token</tt> provided in
every request. To avoid the application service from having to keep track of each
user's access token, the application service should identify itself to the Client-Server
API by providing its <tt class="docutils literal">as_token</tt> for the <tt class="docutils literal">access_token</tt> alongside the user the
application service would like to masquerade as.</p>
<dl class="docutils">
<dt>Inputs:</dt>
<dd><ul class="first last simple">
<li>Application service token (<tt class="docutils literal">as_token</tt>)</li>
<li>User ID in the AS namespace to act as.</li>
</ul>
</dd>
<dt>Notes:</dt>
<dd><ul class="first last simple">
<li>This applies to all aspects of the Client-Server API, except for Account Management.</li>
<li>The <tt class="docutils literal">as_token</tt> is inserted into <tt class="docutils literal">access_token</tt> which is usually where the
client token is, such as via the query string or <tt class="docutils literal">Authorization</tt> header. This
is done on purpose to allow application services to reuse client SDKs.</li>
<li>The <tt class="docutils literal">access_token</tt> should be supplied through the <tt class="docutils literal">Authorization</tt> header where
possible to prevent the token appearing in HTTP request logs by accident.</li>
</ul>
</dd>
</dl>
<p>The application service may specify the virtual user to act as through use of a
<tt class="docutils literal">user_id</tt> query string parameter on the request. The user specified in the query
string must be covered by one of the application service's <tt class="docutils literal">user</tt> namespaces. If
the parameter is missing, the homeserver is to assume the application service intends
to act as the user implied by the <tt class="docutils literal">sender_localpart</tt> property of the registration.</p>
<p>An example request would be:</p>
<pre class="literal-block">
GET /_matrix/client/r0/account/whoami?user_id=&#64;_irc_user:example.org
Authorization: Bearer YourApplicationServiceTokenHere
</pre>
<!-- TODO-TravisR: Temporarily take out timestamp massaging while we're releasing r0.
See https://github.com/matrix-org/matrix-doc/issues/1585 -->
<!-- Timestamp massaging
+++++++++++++++++++
The application service may want to inject events at a certain time (reflecting
the time on the network they are tracking e.g. irc, xmpp). Application services
need to be able to adjust the ``origin_server_ts`` value to do this.

Inputs:
- Application service token (``as_token``)
- Desired timestamp (in milliseconds since the unix epoch)

Notes:
- This will only apply when sending events.

::

 PUT /_matrix/client/r0/rooms/!somewhere:example.org/send/m.room.message/txnId?ts=1534535223283
 Authorization: Bearer YourApplicationServiceTokenHere

 Content: The event to send, as per the Client-Server API. -->
</div>
<p><a class="anchor" id="timestamp-massaging"></a></p>
<div class="section" id="timestamp-massaging">
<h3><a class="toc-backref" href="#id23">2.3.2&nbsp;&nbsp;&nbsp;Timestamp massaging</a></h3>
<p>Previous drafts of the Application Service API permitted application services
to alter the timestamp of their sent events by providing a <tt class="docutils literal">ts</tt> query parameter
when sending an event. This API has been excluded from the first release due to
design concerns, however some servers may still support the feature. Please visit
<a class="reference external" href="https://github.com/matrix-org/matrix-doc/issues/1585">issue #1585</a> for more
information.</p>
</div>
<p><a class="anchor" id="server-admin-style-permissions"></a></p>
<div class="section" id="server-admin-style-permissions">
<h3><a class="toc-backref" href="#id24">2.3.3&nbsp;&nbsp;&nbsp;Server admin style permissions</a></h3>
<p id="sect-asapi-permissions">The homeserver needs to give the application service <em>full control</em> over its
namespace, both for users and for room aliases. This means that the AS should
be able to create/edit/delete any room alias in its namespace, as well as
create/delete any user in its namespace. No additional API changes need to be
made in order for control of room aliases to be granted to the AS. Creation of
users needs API changes in order to:</p>
<ul class="simple">
<li>Work around captchas.</li>
<li>Have a 'passwordless' user.</li>
</ul>
<p>This involves bypassing the registration flows entirely. This is achieved by
including the <tt class="docutils literal">as_token</tt> on a <tt class="docutils literal">/register</tt> request, along with a login type of
<tt class="docutils literal">m.login.application_service</tt> to set the desired user ID without a password.</p>
<pre class="literal-block">
POST /_matrix/client/r0/register
Authorization: Bearer YourApplicationServiceTokenHere

Content:
{
  type: &quot;m.login.application_service&quot;,
  username: &quot;_irc_example&quot;
}
</pre>
<p>Application services which attempt to create users or aliases <em>outside</em> of
their defined namespaces will receive an error code <tt class="docutils literal">M_EXCLUSIVE</tt>. Similarly,
normal users who attempt to create users or aliases <em>inside</em> an application
service-defined namespace will receive the same <tt class="docutils literal">M_EXCLUSIVE</tt> error code,
but only if the application service has defined the namespace as <tt class="docutils literal">exclusive</tt>.</p>
</div>
<p><a class="anchor" id="using-sync-and-events"></a></p>
<div class="section" id="using-sync-and-events">
<h3><a class="toc-backref" href="#id25">2.3.4&nbsp;&nbsp;&nbsp;Using <tt class="docutils literal">/sync</tt> and <tt class="docutils literal">/events</tt></a></h3>
<p>Application services wishing to use <tt class="docutils literal">/sync</tt> or <tt class="docutils literal">/events</tt> from the Client-Server
API MUST do so with a virtual user (provide a <tt class="docutils literal">user_id</tt> via the query string). It
is expected that the application service use the transactions pushed to it to
handle events rather than syncing with the user implied by <tt class="docutils literal">sender_localpart</tt>.</p>
</div>
<p><a class="anchor" id="application-service-room-directories"></a></p>
<div class="section" id="application-service-room-directories">
<h3><a class="toc-backref" href="#id26">2.3.5&nbsp;&nbsp;&nbsp;Application service room directories</a></h3>
<p>Application services can maintain their own room directories for their defined
third party protocols. These room directories may be accessed by clients through
additional parameters on the <tt class="docutils literal">/publicRooms</tt> client-server endpoint.</p>
<p><a class="anchor" id="put-matrix-client-r0-directory-list-appservice-networkid-roomid"></a></p>
<div class="section" id="put-matrix-client-r0-directory-list-appservice-networkid-roomid">
<h4><a class="toc-backref" href="#id27">2.3.5.1&nbsp;&nbsp;&nbsp;<tt class="docutils literal">PUT <span class="pre">/_matrix/client/r0/directory/list/appservice/{networkId}/{roomId}</span></tt></a></h4>
<p>Updates the visibility of a given room on the application service's room
directory.</p>
<p>This API is similar to the room directory visibility API used by clients
to update the homeserver's more general room directory.</p>
<p>This API requires the use of an application service access token (<tt class="docutils literal">as_token</tt>)
instead of a typical client's access_token. This API cannot be invoked by
users who are not identified as application services.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Rate-limited:</th><td class="field-body">No.</td>
</tr>
<tr class="field"><th class="field-name">Requires auth:</th><td class="field-body">Yes.</td>
</tr>
</tbody>
</table>
<p class="httpheaders">Request format:</p>
<table border="1" class="colwidths-auto docutils">
<thead valign="bottom">
<tr><th class="head">Parameter</th>
<th class="head">Type</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr><td colspan="3"><em>path parameters</em></td>
</tr>
<tr><td>networkId</td>
<td>string</td>
<td><strong>Required.</strong> The protocol (network) ID to update
the room list for. This would have been provided
by the application service as being listed as a
supported protocol.</td>
</tr>
<tr><td>roomId</td>
<td>string</td>
<td><strong>Required.</strong> The room ID to add to the directory.</td>
</tr>
<tr><td colspan="3"><em>JSON body parameters</em></td>
</tr>
<tr><td>visibility</td>
<td>enum</td>
<td><strong>Required.</strong> Whether the room should be visible
(public) in the directory or not (private). One
of: [&quot;public&quot;, &quot;private&quot;]</td>
</tr>
</tbody>
</table>
<p class="httpheaders">Example request:</p>
<pre class="code http literal-block">
<span class="name function">PUT</span> <span class="name namespace">/_matrix/client/r0/directory/list/appservice/irc/%21somewhere%3Aexample.org</span> <span class="keyword reserved">HTTP</span><span class="operator">/</span><span class="literal number">1.1</span>
<span class="name attribute">Content-Type</span><span class="operator">:</span> <span class="literal">application/json</span>

<span class="punctuation">{</span>
  <span class="name tag">&quot;visibility&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;public&quot;</span>
<span class="punctuation">}</span>
</pre>
<p class="httpheaders">Response:</p>
<p><strong>Status code 200:</strong></p>
<p>The room's directory visibility has been updated.</p>
<p class="httpheaders">Example</p>
<pre class="code json literal-block">
<span class="punctuation">{}</span>
</pre>
</div>
</div>
</div>
<p><a class="anchor" id="referencing-messages-from-a-third-party-network"></a></p>
<div class="section" id="referencing-messages-from-a-third-party-network">
<h2><a class="toc-backref" href="#id28">2.4&nbsp;&nbsp;&nbsp;Referencing messages from a third party network</a></h2>
<p>Application services should include an <tt class="docutils literal">external_url</tt> in the <tt class="docutils literal">content</tt> of
events it emits to indicate where the message came from. This typically applies
to application services that bridge other networks into Matrix, such as IRC,
where an HTTP URL may be available to reference.</p>
<p>Clients should provide users with a way to access the <tt class="docutils literal">external_url</tt> if it
is present. Clients should additionally ensure the URL has a scheme of <tt class="docutils literal">https</tt>
or <tt class="docutils literal">http</tt> before making use of it.</p>
<p>The presence of an <tt class="docutils literal">external_url</tt> on an event does not necessarily mean the
event was sent from an application service. Clients should be wary of the URL
contained within, as it may not be a legitimate reference to the event's source.</p>
</div>
</div>
</div>
</body>
</html>
